<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">r</span>, <span class="var type1" id="S3T2U4">Pk</span>] = kalman_filter_lr (<span class="var type1" id="S2T1U7">r</span>, <span class="var type1" id="S4T3U8">A</span>, <span class="var type1" id="S3T2U9">Pk</span>, <span class="var type1" id="S5T2U10">Q</span>, <span class="var type1" id="S6T3U11">R_fakt</span>, <span class="var type1" id="S7T3U12">delta</span>, <span class="var type1" id="S8T1U13">xl</span>, <span class="var type1" id="S9T1U14">yl</span>, <span class="var type1" id="S10T1U15">xr</span>, <span class="var type1" id="S11T1U16">yr</span>, <span class="var type1" id="S12T1U17">xm</span>, <span class="var type1" id="S13T1U18">ym</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% "kalman_filter_lr" </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% ----Nomenklatur----</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%  * r: Zustandsvektor = [y0, phi0, kappa_1, kappa_2, <span class="keyword">...</span><span class="comment"> , kappa_(n-1)] </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   --&gt; y0: y-Wert des ersten Punktes (x-Wert ist immer 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   --&gt; phi0: Anfangssteigung zwischem ersten und zweiten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   --&gt; kappa_i: Krümmungen an den entsprechenden Punkten (Krümmungsdefinition: 1/R, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   wobei R der Radius des Kreises ist, auf dem der betrachtete Punkt, sein Vorgänger </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   und sein Nachfolger liegen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%  * Pk: Kovarianzmatrix des Zustands dim[n x n], mit n = Dimension des Zustandsvektors</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%  * A: State-Transition-Matrix dim[n x n] (ist zurzeit eine Einheitsmatrix, da noch keine </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%    Messwerte fuer die Eigenbewegung verfügbar sind)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%  * Q: Kovarianz des Zustandsübergangs (Prozessrauschen) dim[n x n] (symmetrische Matrix, mit weg von der </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%    Diagonalen abnehmenden Eintraegen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%  * R_fakt: Unsicherheit der Messwerte (Messrauschen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%  * delta: Abstand der Punkte (delta*n ergibt die Länge des praedizierten Fahrstreifens)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%  * xl, yl: Vektoren mit den Messwerten für die linke Spur</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%  * xr, yr: Vektoren mit den Messwerten für die rechte Spur</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%  ----Grober Ablauf des Algorithmus----</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%  1. Projektion der Punkte von der Mittellinie nach links bzw. rechts</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%  2. Fuer jeden Messpunkt: Berechnung des kleinsten Abstands zum aktuell praedizierten Strassenverlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%  3. Assemblierung der Jakobimatrix fuer die Projektion aus dem Zustandsraum r auf x-y-Koordinaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%  4. Kalman-Filter: Praediktion -&gt; Messwerte einbeziehen -&gt; Update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%  5. Zustandsbegrenzungen einbringen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%% linke Seitenlinie</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">[<span class="var type1" id="S14T1U22">xp</span>, <span class="var type1" id="S15T1U23">yp</span>, <span class="var type1" id="S16T1U24">phi</span>] = <span class="fcn" id="F59N6:B26">projectPoints</span>(<span class="var type1" id="S2T1U27">r</span>, <span class="var type1" id="S7T3U28">delta</span>, <span class="mxinfo " id="T3:U20">0.38</span>); <span class="comment">%Punkte von Mittellinie nach links projizieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T4:U21"><span class="var type1" id="S18T4U32">P</span> = <span class="mxinfo " id="T4:U23">[<span class="var type1" id="S14T1U35">xp</span>, <span class="var type1" id="S15T1U36">yp</span>, <span class="var type1" id="S16T1U37">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T4:U27"><span class="var type1" id="S19T4U40">D</span> = <span class="mxinfo " id="T4:U29"><span class="mxinfo " id="T3:U30">10000</span>*<span class="mxinfo " id="T4:U31">ones(<span class="mxinfo " id="T3:U32">numel(<span class="var type1" id="S8T1U47">xl</span>)</span>, <span class="mxinfo " id="T5:U34">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S22T3U51">s</span>=<span class="mxinfo " id="T3:U36">1</span>:<span class="mxinfo " id="T3:U37">numel(<span class="var type1" id="S2T1U56">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S23T3U59">m</span>=<span class="mxinfo " id="T3:U40">1</span>:<span class="mxinfo " id="T3:U41">numel(<span class="var type1" id="S8T1U64">xl</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">        <span class="mxinfo " id="T3:U43"><span class="var type1" id="S24T3U67">dist_point</span> = <span class="mxinfo " id="T3:U45">sqrt(<span class="mxinfo " id="T3:U46"><span class="mxinfo " id="T3:U47">(<span class="mxinfo " id="T3:U48"><span class="mxinfo " id="T3:U49"><span class="var type1" id="S18T4U75">P</span>(<span class="var type1" id="S22T3U76">s</span>, <span class="mxinfo " id="T5:U52">1</span>)</span>-(<span class="mxinfo " id="T3:U53"><span class="var type1" id="S8T1U80">xl</span>(<span class="var type1" id="S23T3U81">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U56">(<span class="mxinfo " id="T3:U57"><span class="mxinfo " id="T3:U58"><span class="var type1" id="S18T4U87">P</span>(<span class="var type1" id="S22T3U88">s</span>, <span class="mxinfo " id="T5:U61">2</span>)</span>-(<span class="mxinfo " id="T3:U62"><span class="var type1" id="S9T1U92">yl</span>(<span class="var type1" id="S23T3U93">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T6:U65"><span class="var type1" id="S24T3U98">dist_point</span> &lt; <span class="mxinfo " id="T3:U67"><span class="var type1" id="S19T4U100">D</span>(<span class="var type1" id="S23T3U101">m</span>, <span class="mxinfo " id="T3:U70">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">            <span class="mxinfo " id="T3:U71"><span class="mxinfo " id="T3:U72"><span class="var type1" id="S19T4U106">D</span>(<span class="var type1" id="S23T3U107">m</span>, <span class="mxinfo " id="T3:U75">1</span>)</span> = <span class="var type1" id="S22T3U109">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">            <span class="mxinfo " id="T3:U77"><span class="mxinfo " id="T3:U78"><span class="var type1" id="S19T4U113">D</span>(<span class="var type1" id="S23T3U114">m</span>, <span class="mxinfo " id="T3:U81">2</span>)</span> = <span class="mxinfo " id="T3:U82">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">            <span class="mxinfo " id="T3:U83"><span class="mxinfo " id="T3:U84"><span class="var type1" id="S19T4U120">D</span>(<span class="var type1" id="S23T3U121">m</span>, <span class="mxinfo " id="T3:U87">3</span>)</span> = <span class="var type1" id="S24T3U123">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T6:U89"><span class="var type1" id="S22T3U127">s</span> &gt; <span class="mxinfo " id="T3:U91">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">            [<span class="var type1" id="S26T3U132">dist_line</span>, <span class="var type1" id="S27T3U133">lambda</span>, <span class="mxinfo " id="T3:U94">~</span>] = <span class="fcn" id="F66N2:B136">d_line_point</span>(<span class="mxinfo " id="T7:U95">[<span class="mxinfo " id="T3:U96"><span class="var type1" id="S18T4U140">P</span>(<span class="mxinfo " id="T3:U98"><span class="var type1" id="S22T3U142">s</span>-<span class="mxinfo " id="T3:U100">1</span></span>, <span class="mxinfo " id="T5:U101">1</span>)</span>, <span class="mxinfo " id="T3:U102"><span class="var type1" id="S18T4U146">P</span>(<span class="mxinfo " id="T3:U104"><span class="var type1" id="S22T3U148">s</span>-<span class="mxinfo " id="T3:U106">1</span></span>, <span class="mxinfo " id="T5:U107">2</span>)</span>]</span>, <span class="mxinfo " id="T7:U108">[<span class="mxinfo " id="T3:U109"><span class="var type1" id="S18T4U154">P</span>(<span class="var type1" id="S22T3U155">s</span>, <span class="mxinfo " id="T5:U112">1</span>)</span>, <span class="mxinfo " id="T3:U113"><span class="var type1" id="S18T4U158">P</span>(<span class="var type1" id="S22T3U159">s</span>, <span class="mxinfo " id="T5:U116">2</span>)</span>]</span>, <span class="mxinfo " id="T7:U117">[<span class="mxinfo " id="T3:U118"><span class="var type1" id="S8T1U164">xl</span>(<span class="var type1" id="S23T3U165">m</span>)</span>, <span class="mxinfo " id="T3:U121"><span class="var type1" id="S9T1U167">yl</span>(<span class="var type1" id="S23T3U168">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T6:U124"><span class="var type1" id="S26T3U174">dist_line</span> &lt; <span class="mxinfo " id="T3:U126"><span class="var type1" id="S19T4U176">D</span>(<span class="var type1" id="S23T3U177">m</span>, <span class="mxinfo " id="T3:U129">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T6:U130"><span class="var type1" id="S27T3U180">lambda</span> &gt; <span class="mxinfo " id="T3:U132">0</span></span> &amp;&amp; <span class="mxinfo " id="T6:U133"><span class="var type1" id="S27T3U183">lambda</span> &lt; <span class="mxinfo " id="T3:U135">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">                <span class="mxinfo " id="T3:U136"><span class="mxinfo " id="T3:U137"><span class="var type1" id="S19T4U188">D</span>(<span class="var type1" id="S23T3U189">m</span>, <span class="mxinfo " id="T3:U140">1</span>)</span> = <span class="mxinfo " id="T3:U141"><span class="var type1" id="S22T3U192">s</span>-<span class="mxinfo " id="T3:U143">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">                <span class="mxinfo " id="T3:U144"><span class="mxinfo " id="T3:U145"><span class="var type1" id="S19T4U197">D</span>(<span class="var type1" id="S23T3U198">m</span>, <span class="mxinfo " id="T3:U148">2</span>)</span> = <span class="var type1" id="S27T3U200">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">                <span class="mxinfo " id="T3:U150"><span class="mxinfo " id="T3:U151"><span class="var type1" id="S19T4U204">D</span>(<span class="var type1" id="S23T3U205">m</span>, <span class="mxinfo " id="T3:U154">3</span>)</span> = <span class="var type1" id="S26T3U207">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T8:U156"><span class="var type1" id="S29T8U210">ind</span> = (<span class="mxinfo " id="T8:U158"><span class="mxinfo " id="T8:U159"><span class="mxinfo " id="T1:U160"><span class="var type1" id="S19T4U215">D</span>(<span class="mxinfo " id="T9:U162">:</span>, <span class="mxinfo " id="T5:U163">1</span>)</span> == <span class="mxinfo " id="T3:U164">numel(<span class="var type1" id="S2T1U220">r</span>)</span></span> | <span class="mxinfo " id="T8:U166"><span class="mxinfo " id="T1:U167"><span class="var type1" id="S19T4U223">D</span>(<span class="mxinfo " id="T9:U169">:</span>, <span class="mxinfo " id="T3:U170">3</span>)</span> &gt; <span class="mxinfo " id="T3:U171">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T1:U172"><span class="var type1" id="S8T1U230">xl</span>(<span class="var type1" id="S29T8U231">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="mxinfo " id="T1:U175"><span class="var type1" id="S9T1U237">yl</span>(<span class="var type1" id="S29T8U238">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T4:U178"><span class="var type1" id="S19T4U244">D</span>(<span class="var type1" id="S29T8U245">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% Messmatrix, Mess- und Erwartungsvektor bauen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T2:U181"><span class="var type1" id="S30T2U251">Hl</span> = <span class="mxinfo " id="T2:U183"><span class="fcn" id="F85N5:B253">messmatrix</span>(<span class="var type1" id="S18T4U254">P</span>, <span class="var type1" id="S2T1U255">r</span>, <span class="var type1" id="S7T3U256">delta</span>, <span class="mxinfo " id="T1:U187"><span class="var type1" id="S19T4U258">D</span>(<span class="mxinfo " id="T9:U189">:</span>, <span class="mxinfo " id="T5:U190">1</span>)</span>, <span class="mxinfo " id="T1:U191"><span class="var type1" id="S19T4U262">D</span>(<span class="mxinfo " id="T9:U193">:</span>, <span class="mxinfo " id="T5:U194">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T1:U195"><span class="var type1" id="S32T1U267">zl</span> =  <span class="mxinfo " id="T1:U197">zeros(<span class="mxinfo " id="T3:U198"><span class="mxinfo " id="T3:U199">2</span>*<span class="mxinfo " id="T3:U200">numel(<span class="var type1" id="S8T1U274">xl</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T1:U202"><span class="var type1" id="S34T1U278">zml</span> = <span class="mxinfo " id="T1:U204">zeros(<span class="mxinfo " id="T3:U205"><span class="mxinfo " id="T3:U206">2</span>*<span class="mxinfo " id="T3:U207">numel(<span class="var type1" id="S8T1U285">xl</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T3:U209"><span class="var type1" id="S35T3U289">count</span> = <span class="mxinfo " id="T3:U211">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T3U293">m</span>=<span class="mxinfo " id="T3:U213">1</span>:<span class="mxinfo " id="T3:U214">numel(<span class="var type1" id="S8T1U298">xl</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">        <span class="mxinfo " id="T3:U216"><span class="mxinfo " id="T3:U217"><span class="var type1" id="S32T1U302">zl</span>(<span class="var type1" id="S35T3U303">count</span>)</span> = <span class="mxinfo " id="T3:U220"><span class="var type1" id="S8T1U305">xl</span>(<span class="var type1" id="S23T3U306">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">        <span class="mxinfo " id="T3:U223"><span class="mxinfo " id="T3:U224"><span class="var type1" id="S32T1U310">zl</span>(<span class="mxinfo " id="T3:U226"><span class="var type1" id="S35T3U312">count</span> + <span class="mxinfo " id="T3:U228">1</span></span>)</span> = <span class="mxinfo " id="T3:U229"><span class="var type1" id="S9T1U315">yl</span>(<span class="var type1" id="S23T3U316">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">        <span class="mxinfo " id="T3:U232"><span class="mxinfo " id="T3:U233"><span class="var type1" id="S34T1U320">zml</span>(<span class="var type1" id="S35T3U321">count</span>)</span>     = <span class="mxinfo " id="T3:U236"><span class="mxinfo " id="T3:U237"><span class="var type1" id="S18T4U324">P</span>(<span class="mxinfo " id="T3:U239"><span class="var type1" id="S19T4U326">D</span>(<span class="var type1" id="S23T3U327">m</span>, <span class="mxinfo " id="T5:U242">1</span>)</span>, <span class="mxinfo " id="T3:U243">1</span>)</span> + <span class="mxinfo " id="T3:U244"><span class="mxinfo " id="T3:U245"><span class="var type1" id="S19T4U332">D</span>(<span class="var type1" id="S23T3U333">m</span>, <span class="mxinfo " id="T3:U248">2</span>)</span> * (<span class="mxinfo " id="T3:U249"><span class="mxinfo " id="T3:U250"><span class="var type1" id="S18T4U338">P</span>(<span class="mxinfo " id="T3:U252"><span class="mxinfo " id="T3:U253"><span class="var type1" id="S19T4U341">D</span>(<span class="var type1" id="S23T3U342">m</span>, <span class="mxinfo " id="T5:U256">1</span>)</span>+<span class="mxinfo " id="T3:U257">1</span></span>, <span class="mxinfo " id="T3:U258">1</span>)</span> - <span class="mxinfo " id="T3:U259"><span class="var type1" id="S18T4U347">P</span>(<span class="mxinfo " id="T3:U261"><span class="var type1" id="S19T4U349">D</span>(<span class="var type1" id="S23T3U350">m</span>, <span class="mxinfo " id="T5:U264">1</span>)</span>, <span class="mxinfo " id="T3:U265">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">        <span class="mxinfo " id="T3:U266"><span class="mxinfo " id="T3:U267"><span class="var type1" id="S34T1U356">zml</span>(<span class="mxinfo " id="T3:U269"><span class="var type1" id="S35T3U358">count</span> + <span class="mxinfo " id="T3:U271">1</span></span>)</span> = <span class="mxinfo " id="T3:U272"><span class="mxinfo " id="T3:U273"><span class="var type1" id="S18T4U362">P</span>(<span class="mxinfo " id="T3:U275"><span class="var type1" id="S19T4U364">D</span>(<span class="var type1" id="S23T3U365">m</span>, <span class="mxinfo " id="T5:U278">1</span>)</span>, <span class="mxinfo " id="T3:U279">2</span>)</span> + <span class="mxinfo " id="T3:U280"><span class="mxinfo " id="T3:U281"><span class="var type1" id="S19T4U370">D</span>(<span class="var type1" id="S23T3U371">m</span>, <span class="mxinfo " id="T3:U284">2</span>)</span> * (<span class="mxinfo " id="T3:U285"><span class="mxinfo " id="T3:U286"><span class="var type1" id="S18T4U376">P</span>(<span class="mxinfo " id="T3:U288"><span class="mxinfo " id="T3:U289"><span class="var type1" id="S19T4U379">D</span>(<span class="var type1" id="S23T3U380">m</span>, <span class="mxinfo " id="T5:U292">1</span>)</span>+<span class="mxinfo " id="T3:U293">1</span></span>, <span class="mxinfo " id="T3:U294">2</span>)</span> - <span class="mxinfo " id="T3:U295"><span class="var type1" id="S18T4U385">P</span>(<span class="mxinfo " id="T3:U297"><span class="var type1" id="S19T4U387">D</span>(<span class="var type1" id="S23T3U388">m</span>, <span class="mxinfo " id="T5:U300">1</span>)</span>, <span class="mxinfo " id="T3:U301">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">        <span class="mxinfo " id="T3:U302"><span class="var type1" id="S35T3U393">count</span> = <span class="mxinfo " id="T3:U304"><span class="var type1" id="S35T3U395">count</span> + <span class="mxinfo " id="T3:U306">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%% rechte Seitenlinie</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">[<span class="var type1" id="S14T1U400">xp</span>, <span class="var type1" id="S15T1U401">yp</span>, <span class="var type1" id="S16T1U402">phi</span>] = <span class="fcn" id="F59N6:B404">projectPoints</span>(<span class="var type1" id="S2T1U405">r</span>, <span class="var type1" id="S7T3U406">delta</span>, <span class="mxinfo " id="T3:U312">-0.38</span>); <span class="comment">%Punkte von Mittellinie nach rechts projizieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo " id="T4:U313"><span class="var type1" id="S18T4U411">P</span> = <span class="mxinfo " id="T4:U315">[<span class="var type1" id="S14T1U414">xp</span>, <span class="var type1" id="S15T1U415">yp</span>, <span class="var type1" id="S16T1U416">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T4:U319"><span class="var type1" id="S19T4U419">D</span> = <span class="mxinfo " id="T4:U321"><span class="mxinfo " id="T3:U322">10000</span>*<span class="mxinfo " id="T4:U323">ones(<span class="mxinfo " id="T3:U324">numel(<span class="var type1" id="S10T1U426">xr</span>)</span>, <span class="mxinfo " id="T5:U326">3</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S22T3U430">s</span>=<span class="mxinfo " id="T3:U328">1</span>:<span class="mxinfo " id="T3:U329">numel(<span class="var type1" id="S2T1U435">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S23T3U438">m</span>=<span class="mxinfo " id="T3:U332">1</span>:<span class="mxinfo " id="T3:U333">numel(<span class="var type1" id="S10T1U443">xr</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">        <span class="mxinfo " id="T3:U335"><span class="var type1" id="S24T3U446">dist_point</span> = <span class="mxinfo " id="T3:U337">sqrt(<span class="mxinfo " id="T3:U338"><span class="mxinfo " id="T3:U339">(<span class="mxinfo " id="T3:U340"><span class="mxinfo " id="T3:U341"><span class="var type1" id="S18T4U454">P</span>(<span class="var type1" id="S22T3U455">s</span>, <span class="mxinfo " id="T5:U344">1</span>)</span>-(<span class="mxinfo " id="T3:U345"><span class="var type1" id="S10T1U459">xr</span>(<span class="var type1" id="S23T3U460">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U348">(<span class="mxinfo " id="T3:U349"><span class="mxinfo " id="T3:U350"><span class="var type1" id="S18T4U466">P</span>(<span class="var type1" id="S22T3U467">s</span>, <span class="mxinfo " id="T5:U353">2</span>)</span>-(<span class="mxinfo " id="T3:U354"><span class="var type1" id="S11T1U471">yr</span>(<span class="var type1" id="S23T3U472">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T6:U357"><span class="var type1" id="S24T3U477">dist_point</span> &lt; <span class="mxinfo " id="T3:U359"><span class="var type1" id="S19T4U479">D</span>(<span class="var type1" id="S23T3U480">m</span>, <span class="mxinfo " id="T3:U362">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">            <span class="mxinfo " id="T3:U363"><span class="mxinfo " id="T3:U364"><span class="var type1" id="S19T4U485">D</span>(<span class="var type1" id="S23T3U486">m</span>, <span class="mxinfo " id="T3:U367">1</span>)</span> = <span class="var type1" id="S22T3U488">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T3:U369"><span class="mxinfo " id="T3:U370"><span class="var type1" id="S19T4U492">D</span>(<span class="var type1" id="S23T3U493">m</span>, <span class="mxinfo " id="T3:U373">2</span>)</span> = <span class="mxinfo " id="T3:U374">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">            <span class="mxinfo " id="T3:U375"><span class="mxinfo " id="T3:U376"><span class="var type1" id="S19T4U499">D</span>(<span class="var type1" id="S23T3U500">m</span>, <span class="mxinfo " id="T3:U379">3</span>)</span> = <span class="var type1" id="S24T3U502">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T6:U381"><span class="var type1" id="S22T3U506">s</span> &gt; <span class="mxinfo " id="T3:U383">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">            [<span class="var type1" id="S26T3U511">dist_line</span>, <span class="var type1" id="S27T3U512">lambda</span>, <span class="mxinfo " id="T3:U386">~</span>] = <span class="fcn" id="F66N2:B515">d_line_point</span>(<span class="mxinfo " id="T7:U387">[<span class="mxinfo " id="T3:U388"><span class="var type1" id="S18T4U519">P</span>(<span class="mxinfo " id="T3:U390"><span class="var type1" id="S22T3U521">s</span>-<span class="mxinfo " id="T3:U392">1</span></span>, <span class="mxinfo " id="T5:U393">1</span>)</span>, <span class="mxinfo " id="T3:U394"><span class="var type1" id="S18T4U525">P</span>(<span class="mxinfo " id="T3:U396"><span class="var type1" id="S22T3U527">s</span>-<span class="mxinfo " id="T3:U398">1</span></span>, <span class="mxinfo " id="T5:U399">2</span>)</span>]</span>, <span class="mxinfo " id="T7:U400">[<span class="mxinfo " id="T3:U401"><span class="var type1" id="S18T4U533">P</span>(<span class="var type1" id="S22T3U534">s</span>, <span class="mxinfo " id="T5:U404">1</span>)</span>, <span class="mxinfo " id="T3:U405"><span class="var type1" id="S18T4U537">P</span>(<span class="var type1" id="S22T3U538">s</span>, <span class="mxinfo " id="T5:U408">2</span>)</span>]</span>, <span class="mxinfo " id="T7:U409">[<span class="mxinfo " id="T3:U410"><span class="var type1" id="S10T1U543">xr</span>(<span class="var type1" id="S23T3U544">m</span>)</span>, <span class="mxinfo " id="T3:U413"><span class="var type1" id="S11T1U546">yr</span>(<span class="var type1" id="S23T3U547">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T6:U416"><span class="var type1" id="S26T3U553">dist_line</span> &lt; <span class="mxinfo " id="T3:U418"><span class="var type1" id="S19T4U555">D</span>(<span class="var type1" id="S23T3U556">m</span>, <span class="mxinfo " id="T3:U421">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T6:U422"><span class="var type1" id="S27T3U559">lambda</span> &gt; <span class="mxinfo " id="T3:U424">0</span></span> &amp;&amp; <span class="mxinfo " id="T6:U425"><span class="var type1" id="S27T3U562">lambda</span> &lt; <span class="mxinfo " id="T3:U427">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">                <span class="mxinfo " id="T3:U428"><span class="mxinfo " id="T3:U429"><span class="var type1" id="S19T4U567">D</span>(<span class="var type1" id="S23T3U568">m</span>, <span class="mxinfo " id="T3:U432">1</span>)</span> = <span class="mxinfo " id="T3:U433"><span class="var type1" id="S22T3U571">s</span>-<span class="mxinfo " id="T3:U435">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">                <span class="mxinfo " id="T3:U436"><span class="mxinfo " id="T3:U437"><span class="var type1" id="S19T4U576">D</span>(<span class="var type1" id="S23T3U577">m</span>, <span class="mxinfo " id="T3:U440">2</span>)</span> = <span class="var type1" id="S27T3U579">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">                <span class="mxinfo " id="T3:U442"><span class="mxinfo " id="T3:U443"><span class="var type1" id="S19T4U583">D</span>(<span class="var type1" id="S23T3U584">m</span>, <span class="mxinfo " id="T3:U446">3</span>)</span> = <span class="var type1" id="S26T3U586">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">% ind = ((D(:, 1) == numel(r) &amp; D(:, 2) == 0) | D(:, 3) &gt; 0.5 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T8:U448"><span class="var type1" id="S29T8U589">ind</span> = (<span class="mxinfo " id="T8:U450"><span class="mxinfo " id="T8:U451"><span class="mxinfo " id="T1:U452"><span class="var type1" id="S19T4U594">D</span>(<span class="mxinfo " id="T9:U454">:</span>, <span class="mxinfo " id="T5:U455">1</span>)</span> == <span class="mxinfo " id="T3:U456">numel(<span class="var type1" id="S2T1U599">r</span>)</span></span> | <span class="mxinfo " id="T8:U458"><span class="mxinfo " id="T1:U459"><span class="var type1" id="S19T4U602">D</span>(<span class="mxinfo " id="T9:U461">:</span>, <span class="mxinfo " id="T3:U462">3</span>)</span> &gt; <span class="mxinfo " id="T3:U463">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T1:U464"><span class="var type1" id="S10T1U609">xr</span>(<span class="var type1" id="S29T8U610">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T1:U467"><span class="var type1" id="S11T1U616">yr</span>(<span class="var type1" id="S29T8U617">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T4:U470"><span class="var type1" id="S19T4U623">D</span>(<span class="var type1" id="S29T8U624">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">% Messmatrix, Mess- und Erwartungsvektor bauen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="mxinfo " id="T2:U473"><span class="var type1" id="S36T2U630">Hr</span> = <span class="mxinfo " id="T2:U475"><span class="fcn" id="F85N5:B632">messmatrix</span>(<span class="var type1" id="S18T4U633">P</span>, <span class="var type1" id="S2T1U634">r</span>, <span class="var type1" id="S7T3U635">delta</span>, <span class="mxinfo " id="T1:U479"><span class="var type1" id="S19T4U637">D</span>(<span class="mxinfo " id="T9:U481">:</span>, <span class="mxinfo " id="T5:U482">1</span>)</span>, <span class="mxinfo " id="T1:U483"><span class="var type1" id="S19T4U641">D</span>(<span class="mxinfo " id="T9:U485">:</span>, <span class="mxinfo " id="T5:U486">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T1:U487"><span class="var type1" id="S37T1U646">zr</span> =  <span class="mxinfo " id="T1:U489">zeros(<span class="mxinfo " id="T3:U490"><span class="mxinfo " id="T3:U491">2</span>*<span class="mxinfo " id="T3:U492">numel(<span class="var type1" id="S10T1U653">xr</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo " id="T1:U494"><span class="var type1" id="S38T1U657">zmr</span> = <span class="mxinfo " id="T1:U496">zeros(<span class="mxinfo " id="T3:U497"><span class="mxinfo " id="T3:U498">2</span>*<span class="mxinfo " id="T3:U499">numel(<span class="var type1" id="S10T1U664">xr</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo " id="T3:U501"><span class="var type1" id="S35T3U668">count</span> = <span class="mxinfo " id="T3:U503">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T3U672">m</span>=<span class="mxinfo " id="T3:U505">1</span>:<span class="mxinfo " id="T3:U506">numel(<span class="var type1" id="S10T1U677">xr</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        <span class="mxinfo " id="T3:U508"><span class="mxinfo " id="T3:U509"><span class="var type1" id="S37T1U681">zr</span>(<span class="var type1" id="S35T3U682">count</span>)</span> = <span class="mxinfo " id="T3:U512"><span class="var type1" id="S10T1U684">xr</span>(<span class="var type1" id="S23T3U685">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo " id="T3:U515"><span class="mxinfo " id="T3:U516"><span class="var type1" id="S37T1U689">zr</span>(<span class="mxinfo " id="T3:U518"><span class="var type1" id="S35T3U691">count</span> + <span class="mxinfo " id="T3:U520">1</span></span>)</span> = <span class="mxinfo " id="T3:U521"><span class="var type1" id="S11T1U694">yr</span>(<span class="var type1" id="S23T3U695">m</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">        <span class="mxinfo " id="T3:U524"><span class="mxinfo " id="T3:U525"><span class="var type1" id="S38T1U699">zmr</span>(<span class="var type1" id="S35T3U700">count</span>)</span>     = <span class="mxinfo " id="T3:U528"><span class="mxinfo " id="T3:U529"><span class="var type1" id="S18T4U703">P</span>(<span class="mxinfo " id="T3:U531"><span class="var type1" id="S19T4U705">D</span>(<span class="var type1" id="S23T3U706">m</span>, <span class="mxinfo " id="T5:U534">1</span>)</span>, <span class="mxinfo " id="T3:U535">1</span>)</span> + <span class="mxinfo " id="T3:U536"><span class="mxinfo " id="T3:U537"><span class="var type1" id="S19T4U711">D</span>(<span class="var type1" id="S23T3U712">m</span>, <span class="mxinfo " id="T3:U540">2</span>)</span> * (<span class="mxinfo " id="T3:U541"><span class="mxinfo " id="T3:U542"><span class="var type1" id="S18T4U717">P</span>(<span class="mxinfo " id="T3:U544"><span class="mxinfo " id="T3:U545"><span class="var type1" id="S19T4U720">D</span>(<span class="var type1" id="S23T3U721">m</span>, <span class="mxinfo " id="T5:U548">1</span>)</span>+<span class="mxinfo " id="T3:U549">1</span></span>, <span class="mxinfo " id="T3:U550">1</span>)</span> - <span class="mxinfo " id="T3:U551"><span class="var type1" id="S18T4U726">P</span>(<span class="mxinfo " id="T3:U553"><span class="var type1" id="S19T4U728">D</span>(<span class="var type1" id="S23T3U729">m</span>, <span class="mxinfo " id="T5:U556">1</span>)</span>, <span class="mxinfo " id="T3:U557">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo " id="T3:U558"><span class="mxinfo " id="T3:U559"><span class="var type1" id="S38T1U735">zmr</span>(<span class="mxinfo " id="T3:U561"><span class="var type1" id="S35T3U737">count</span> + <span class="mxinfo " id="T3:U563">1</span></span>)</span> = <span class="mxinfo " id="T3:U564"><span class="mxinfo " id="T3:U565"><span class="var type1" id="S18T4U741">P</span>(<span class="mxinfo " id="T3:U567"><span class="var type1" id="S19T4U743">D</span>(<span class="var type1" id="S23T3U744">m</span>, <span class="mxinfo " id="T5:U570">1</span>)</span>, <span class="mxinfo " id="T3:U571">2</span>)</span> + <span class="mxinfo " id="T3:U572"><span class="mxinfo " id="T3:U573"><span class="var type1" id="S19T4U749">D</span>(<span class="var type1" id="S23T3U750">m</span>, <span class="mxinfo " id="T3:U576">2</span>)</span> * (<span class="mxinfo " id="T3:U577"><span class="mxinfo " id="T3:U578"><span class="var type1" id="S18T4U755">P</span>(<span class="mxinfo " id="T3:U580"><span class="mxinfo " id="T3:U581"><span class="var type1" id="S19T4U758">D</span>(<span class="var type1" id="S23T3U759">m</span>, <span class="mxinfo " id="T5:U584">1</span>)</span>+<span class="mxinfo " id="T3:U585">1</span></span>, <span class="mxinfo " id="T3:U586">2</span>)</span> - <span class="mxinfo " id="T3:U587"><span class="var type1" id="S18T4U764">P</span>(<span class="mxinfo " id="T3:U589"><span class="var type1" id="S19T4U766">D</span>(<span class="var type1" id="S23T3U767">m</span>, <span class="mxinfo " id="T5:U592">1</span>)</span>, <span class="mxinfo " id="T3:U593">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">        <span class="mxinfo " id="T3:U594"><span class="var type1" id="S35T3U772">count</span> = <span class="mxinfo " id="T3:U596"><span class="var type1" id="S35T3U774">count</span> + <span class="mxinfo " id="T3:U598">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">%% Mittellinie</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">[<span class="var type1" id="S14T1U779">xp</span>, <span class="var type1" id="S15T1U780">yp</span>, <span class="var type1" id="S16T1U781">phi</span>] = <span class="fcn" id="F19N3:B783">getPointsFromState</span>(<span class="var type1" id="S2T1U784">r</span>, <span class="var type1" id="S7T3U785">delta</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T4:U604"><span class="var type1" id="S18T4U788">P</span> = <span class="mxinfo " id="T4:U606">[<span class="var type1" id="S14T1U791">xp</span>, <span class="var type1" id="S15T1U792">yp</span>, <span class="var type1" id="S16T1U793">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="mxinfo " id="T4:U610"><span class="var type1" id="S19T4U796">D</span> = <span class="mxinfo " id="T4:U612"><span class="mxinfo " id="T3:U613">10000</span>*<span class="mxinfo " id="T4:U614">ones(<span class="mxinfo " id="T3:U615">numel(<span class="var type1" id="S12T1U803">xm</span>)</span>, <span class="mxinfo " id="T5:U617">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S22T3U807">s</span>=<span class="mxinfo " id="T3:U619">1</span>:<span class="mxinfo " id="T3:U620">numel(<span class="var type1" id="S2T1U812">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S23T3U815">m</span>=<span class="mxinfo " id="T3:U623">1</span>:<span class="mxinfo " id="T3:U624">numel(<span class="var type1" id="S12T1U820">xm</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">        <span class="mxinfo " id="T3:U626"><span class="var type1" id="S24T3U823">dist_point</span> = <span class="mxinfo " id="T3:U628">sqrt(<span class="mxinfo " id="T3:U629"><span class="mxinfo " id="T3:U630">(<span class="mxinfo " id="T3:U631"><span class="mxinfo " id="T3:U632"><span class="var type1" id="S18T4U831">P</span>(<span class="var type1" id="S22T3U832">s</span>, <span class="mxinfo " id="T5:U635">1</span>)</span>-(<span class="mxinfo " id="T3:U636"><span class="var type1" id="S12T1U836">xm</span>(<span class="var type1" id="S23T3U837">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U639">(<span class="mxinfo " id="T3:U640"><span class="mxinfo " id="T3:U641"><span class="var type1" id="S18T4U843">P</span>(<span class="var type1" id="S22T3U844">s</span>, <span class="mxinfo " id="T5:U644">2</span>)</span>-(<span class="mxinfo " id="T3:U645"><span class="var type1" id="S13T1U848">ym</span>(<span class="var type1" id="S23T3U849">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T6:U648"><span class="var type1" id="S24T3U854">dist_point</span> &lt; <span class="mxinfo " id="T3:U650"><span class="var type1" id="S19T4U856">D</span>(<span class="var type1" id="S23T3U857">m</span>, <span class="mxinfo " id="T3:U653">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">            <span class="mxinfo " id="T3:U654"><span class="mxinfo " id="T3:U655"><span class="var type1" id="S19T4U862">D</span>(<span class="var type1" id="S23T3U863">m</span>, <span class="mxinfo " id="T3:U658">1</span>)</span> = <span class="var type1" id="S22T3U865">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">            <span class="mxinfo " id="T3:U660"><span class="mxinfo " id="T3:U661"><span class="var type1" id="S19T4U869">D</span>(<span class="var type1" id="S23T3U870">m</span>, <span class="mxinfo " id="T3:U664">2</span>)</span> = <span class="mxinfo " id="T3:U665">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">            <span class="mxinfo " id="T3:U666"><span class="mxinfo " id="T3:U667"><span class="var type1" id="S19T4U876">D</span>(<span class="var type1" id="S23T3U877">m</span>, <span class="mxinfo " id="T3:U670">3</span>)</span> = <span class="var type1" id="S24T3U879">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T6:U672"><span class="var type1" id="S22T3U883">s</span> &gt; <span class="mxinfo " id="T3:U674">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">            [<span class="var type1" id="S26T3U888">dist_line</span>, <span class="var type1" id="S27T3U889">lambda</span>, <span class="mxinfo " id="T3:U677">~</span>] = <span class="fcn" id="F66N2:B892">d_line_point</span>(<span class="mxinfo " id="T7:U678">[<span class="mxinfo " id="T3:U679"><span class="var type1" id="S18T4U896">P</span>(<span class="mxinfo " id="T3:U681"><span class="var type1" id="S22T3U898">s</span>-<span class="mxinfo " id="T3:U683">1</span></span>, <span class="mxinfo " id="T5:U684">1</span>)</span>, <span class="mxinfo " id="T3:U685"><span class="var type1" id="S18T4U902">P</span>(<span class="mxinfo " id="T3:U687"><span class="var type1" id="S22T3U904">s</span>-<span class="mxinfo " id="T3:U689">1</span></span>, <span class="mxinfo " id="T5:U690">2</span>)</span>]</span>, <span class="mxinfo " id="T7:U691">[<span class="mxinfo " id="T3:U692"><span class="var type1" id="S18T4U910">P</span>(<span class="var type1" id="S22T3U911">s</span>, <span class="mxinfo " id="T5:U695">1</span>)</span>, <span class="mxinfo " id="T3:U696"><span class="var type1" id="S18T4U914">P</span>(<span class="var type1" id="S22T3U915">s</span>, <span class="mxinfo " id="T5:U699">2</span>)</span>]</span>, <span class="mxinfo " id="T7:U700">[<span class="mxinfo " id="T3:U701"><span class="var type1" id="S12T1U920">xm</span>(<span class="var type1" id="S23T3U921">m</span>)</span>, <span class="mxinfo " id="T3:U704"><span class="var type1" id="S13T1U923">ym</span>(<span class="var type1" id="S23T3U924">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T6:U707"><span class="var type1" id="S26T3U930">dist_line</span> &lt; <span class="mxinfo " id="T3:U709"><span class="var type1" id="S19T4U932">D</span>(<span class="var type1" id="S23T3U933">m</span>, <span class="mxinfo " id="T3:U712">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T6:U713"><span class="var type1" id="S27T3U936">lambda</span> &gt; <span class="mxinfo " id="T3:U715">0</span></span> &amp;&amp; <span class="mxinfo " id="T6:U716"><span class="var type1" id="S27T3U939">lambda</span> &lt; <span class="mxinfo " id="T3:U718">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">                <span class="mxinfo " id="T3:U719"><span class="mxinfo " id="T3:U720"><span class="var type1" id="S19T4U944">D</span>(<span class="var type1" id="S23T3U945">m</span>, <span class="mxinfo " id="T3:U723">1</span>)</span> = <span class="mxinfo " id="T3:U724"><span class="var type1" id="S22T3U948">s</span>-<span class="mxinfo " id="T3:U726">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">                <span class="mxinfo " id="T3:U727"><span class="mxinfo " id="T3:U728"><span class="var type1" id="S19T4U953">D</span>(<span class="var type1" id="S23T3U954">m</span>, <span class="mxinfo " id="T3:U731">2</span>)</span> = <span class="var type1" id="S27T3U956">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">                <span class="mxinfo " id="T3:U733"><span class="mxinfo " id="T3:U734"><span class="var type1" id="S19T4U960">D</span>(<span class="var type1" id="S23T3U961">m</span>, <span class="mxinfo " id="T3:U737">3</span>)</span> = <span class="var type1" id="S26T3U963">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="mxinfo " id="T8:U739"><span class="var type1" id="S29T8U966">ind</span> = (<span class="mxinfo " id="T8:U741"><span class="mxinfo " id="T8:U742"><span class="mxinfo " id="T1:U743"><span class="var type1" id="S19T4U971">D</span>(<span class="mxinfo " id="T9:U745">:</span>, <span class="mxinfo " id="T5:U746">1</span>)</span> == <span class="mxinfo " id="T3:U747">numel(<span class="var type1" id="S2T1U976">r</span>)</span></span> | <span class="mxinfo " id="T8:U749"><span class="mxinfo " id="T1:U750"><span class="var type1" id="S19T4U979">D</span>(<span class="mxinfo " id="T9:U752">:</span>, <span class="mxinfo " id="T3:U753">3</span>)</span> &gt; <span class="mxinfo " id="T3:U754">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo " id="T1:U755"><span class="var type1" id="S12T1U986">xm</span>(<span class="var type1" id="S29T8U987">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo " id="T1:U758"><span class="var type1" id="S13T1U993">ym</span>(<span class="var type1" id="S29T8U994">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo " id="T4:U761"><span class="var type1" id="S19T4U1000">D</span>(<span class="var type1" id="S29T8U1001">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="comment">% Messmatrix, Mess- und Erwartungsvektor bauen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo " id="T2:U764"><span class="var type1" id="S40T2U1007">Hm</span> = <span class="mxinfo " id="T2:U766"><span class="fcn" id="F85N5:B1009">messmatrix</span>(<span class="var type1" id="S18T4U1010">P</span>, <span class="var type1" id="S2T1U1011">r</span>, <span class="var type1" id="S7T3U1012">delta</span>, <span class="mxinfo " id="T1:U770"><span class="var type1" id="S19T4U1014">D</span>(<span class="mxinfo " id="T9:U772">:</span>, <span class="mxinfo " id="T5:U773">1</span>)</span>, <span class="mxinfo " id="T1:U774"><span class="var type1" id="S19T4U1018">D</span>(<span class="mxinfo " id="T9:U776">:</span>, <span class="mxinfo " id="T5:U777">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo " id="T1:U778"><span class="var type1" id="S41T1U1023">z_m</span> =  <span class="mxinfo " id="T1:U780">zeros(<span class="mxinfo " id="T3:U781"><span class="mxinfo " id="T3:U782">2</span>*<span class="mxinfo " id="T3:U783">numel(<span class="var type1" id="S12T1U1030">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo " id="T1:U785"><span class="var type1" id="S42T1U1034">zmm</span> = <span class="mxinfo " id="T1:U787">zeros(<span class="mxinfo " id="T3:U788"><span class="mxinfo " id="T3:U789">2</span>*<span class="mxinfo " id="T3:U790">numel(<span class="var type1" id="S12T1U1041">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo " id="T3:U792"><span class="var type1" id="S35T3U1045">count</span> = <span class="mxinfo " id="T3:U794">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S23T3U1049">m</span>=<span class="mxinfo " id="T3:U796">1</span>:<span class="mxinfo " id="T3:U797">numel(<span class="var type1" id="S12T1U1054">xm</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="mxinfo " id="T3:U799"><span class="mxinfo " id="T3:U800"><span class="var type1" id="S41T1U1058">z_m</span>(<span class="var type1" id="S35T3U1059">count</span>)</span> = <span class="mxinfo " id="T3:U803"><span class="var type1" id="S12T1U1061">xm</span>(<span class="var type1" id="S23T3U1062">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">        <span class="mxinfo " id="T3:U806"><span class="mxinfo " id="T3:U807"><span class="var type1" id="S41T1U1066">z_m</span>(<span class="mxinfo " id="T3:U809"><span class="var type1" id="S35T3U1068">count</span> + <span class="mxinfo " id="T3:U811">1</span></span>)</span> = <span class="mxinfo " id="T3:U812"><span class="var type1" id="S13T1U1071">ym</span>(<span class="var type1" id="S23T3U1072">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">        <span class="mxinfo " id="T3:U815"><span class="mxinfo " id="T3:U816"><span class="var type1" id="S42T1U1076">zmm</span>(<span class="var type1" id="S35T3U1077">count</span>)</span>     = <span class="mxinfo " id="T3:U819"><span class="mxinfo " id="T3:U820"><span class="var type1" id="S18T4U1080">P</span>(<span class="mxinfo " id="T3:U822"><span class="var type1" id="S19T4U1082">D</span>(<span class="var type1" id="S23T3U1083">m</span>, <span class="mxinfo " id="T5:U825">1</span>)</span>, <span class="mxinfo " id="T3:U826">1</span>)</span> + <span class="mxinfo " id="T3:U827"><span class="mxinfo " id="T3:U828"><span class="var type1" id="S19T4U1088">D</span>(<span class="var type1" id="S23T3U1089">m</span>, <span class="mxinfo " id="T3:U831">2</span>)</span> * (<span class="mxinfo " id="T3:U832"><span class="mxinfo " id="T3:U833"><span class="var type1" id="S18T4U1094">P</span>(<span class="mxinfo " id="T3:U835"><span class="mxinfo " id="T3:U836"><span class="var type1" id="S19T4U1097">D</span>(<span class="var type1" id="S23T3U1098">m</span>, <span class="mxinfo " id="T5:U839">1</span>)</span>+<span class="mxinfo " id="T3:U840">1</span></span>, <span class="mxinfo " id="T3:U841">1</span>)</span> - <span class="mxinfo " id="T3:U842"><span class="var type1" id="S18T4U1103">P</span>(<span class="mxinfo " id="T3:U844"><span class="var type1" id="S19T4U1105">D</span>(<span class="var type1" id="S23T3U1106">m</span>, <span class="mxinfo " id="T5:U847">1</span>)</span>, <span class="mxinfo " id="T3:U848">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">        <span class="mxinfo " id="T3:U849"><span class="mxinfo " id="T3:U850"><span class="var type1" id="S42T1U1112">zmm</span>(<span class="mxinfo " id="T3:U852"><span class="var type1" id="S35T3U1114">count</span> + <span class="mxinfo " id="T3:U854">1</span></span>)</span> = <span class="mxinfo " id="T3:U855"><span class="mxinfo " id="T3:U856"><span class="var type1" id="S18T4U1118">P</span>(<span class="mxinfo " id="T3:U858"><span class="var type1" id="S19T4U1120">D</span>(<span class="var type1" id="S23T3U1121">m</span>, <span class="mxinfo " id="T5:U861">1</span>)</span>, <span class="mxinfo " id="T3:U862">2</span>)</span> + <span class="mxinfo " id="T3:U863"><span class="mxinfo " id="T3:U864"><span class="var type1" id="S19T4U1126">D</span>(<span class="var type1" id="S23T3U1127">m</span>, <span class="mxinfo " id="T3:U867">2</span>)</span> * (<span class="mxinfo " id="T3:U868"><span class="mxinfo " id="T3:U869"><span class="var type1" id="S18T4U1132">P</span>(<span class="mxinfo " id="T3:U871"><span class="mxinfo " id="T3:U872"><span class="var type1" id="S19T4U1135">D</span>(<span class="var type1" id="S23T3U1136">m</span>, <span class="mxinfo " id="T5:U875">1</span>)</span>+<span class="mxinfo " id="T3:U876">1</span></span>, <span class="mxinfo " id="T3:U877">2</span>)</span> - <span class="mxinfo " id="T3:U878"><span class="var type1" id="S18T4U1141">P</span>(<span class="mxinfo " id="T3:U880"><span class="var type1" id="S19T4U1143">D</span>(<span class="var type1" id="S23T3U1144">m</span>, <span class="mxinfo " id="T5:U883">1</span>)</span>, <span class="mxinfo " id="T3:U884">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">        <span class="mxinfo " id="T3:U885"><span class="var type1" id="S35T3U1149">count</span> = <span class="mxinfo " id="T3:U887"><span class="var type1" id="S35T3U1151">count</span> + <span class="mxinfo " id="T3:U889">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"><span class="comment">%% Linke und rechte Linie kombinieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo " id="T2:U890"><span class="var type1" id="S43T2U1155">H</span> = <span class="mxinfo " id="T2:U892">[<span class="var type1" id="S30T2U1158">Hl</span>; <span class="var type1" id="S36T2U1160">Hr</span>; <span class="var type1" id="S40T2U1162">Hm</span>]</span></span>; <span class="comment">%Messmatrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"><span class="mxinfo " id="T1:U896"><span class="var type1" id="S44T1U1165">z</span> = <span class="mxinfo " id="T1:U898">[<span class="var type1" id="S32T1U1168">zl</span>; <span class="var type1" id="S37T1U1170">zr</span>; <span class="var type1" id="S41T1U1172">z_m</span>]</span></span>; <span class="comment">%Messwerte</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo " id="T1:U902"><span class="var type1" id="S45T1U1175">zm</span> = <span class="mxinfo " id="T1:U904">[<span class="var type1" id="S34T1U1178">zml</span>; <span class="var type1" id="S38T1U1180">zmr</span>; <span class="var type1" id="S42T1U1182">zmm</span>]</span></span>; <span class="comment">%erwartete Werte</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="comment">%% KALMAN FILTER    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T3:U908"><span class="var type1" id="S46T3U1185">dd</span> = <span class="mxinfo " id="T3:U910">0.013</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T2:U911"><span class="var type1" id="S4T2U1189">A</span> = <span class="mxinfo " id="T2:U913">zeros(<span class="mxinfo " id="T3:U914">numel(<span class="var type1" id="S2T1U1194">r</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo " id="T3:U916"><span class="mxinfo " id="T3:U917"><span class="var type1" id="S4T2U1198">A</span>(<span class="mxinfo " id="T3:U919">1</span>,<span class="mxinfo " id="T3:U920">1</span>)</span> = <span class="mxinfo " id="T3:U921">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T3:U922"><span class="mxinfo " id="T3:U923"><span class="var type1" id="S4T2U1205">A</span>(<span class="mxinfo " id="T3:U925">2</span>,<span class="mxinfo " id="T3:U926">2</span>)</span> = <span class="mxinfo " id="T3:U927">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="mxinfo " id="T3:U928"><span class="mxinfo " id="T3:U929"><span class="var type1" id="S4T2U1212">A</span>(<span class="mxinfo " id="T3:U931">2</span>,<span class="mxinfo " id="T3:U932">3</span>)</span> = <span class="mxinfo " id="T3:U933"><span class="var type1" id="S46T3U1216">dd</span>/<span class="mxinfo " id="T3:U935">sqrt(<span class="mxinfo " id="T3:U936"><span class="mxinfo " id="T3:U937">1</span>-<span class="mxinfo " id="T3:U938"><span class="mxinfo " id="T3:U939"><span class="mxinfo " id="T3:U940"><span class="var type1" id="S7T3U1224">delta</span>^2</span>*<span class="mxinfo " id="T3:U942"><span class="mxinfo " id="T3:U943"><span class="var type1" id="S2T1U1228">r</span>(<span class="mxinfo " id="T3:U945">3</span>)</span>^2</span></span>/<span class="mxinfo " id="T3:U946">4</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S47T3U1234">i</span>=<span class="mxinfo " id="T3:U948">3</span>:<span class="mxinfo " id="T3:U949"><span class="mxinfo " id="T3:U950">numel(<span class="var type1" id="S2T1U1240">r</span>)</span>-<span class="mxinfo " id="T3:U952">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">    <span class="mxinfo " id="T3:U953"><span class="mxinfo " id="T3:U954"><span class="var type1" id="S4T2U1245">A</span>(<span class="var type1" id="S47T3U1246">i</span>,<span class="var type1" id="S47T3U1247">i</span>)</span> = <span class="mxinfo " id="T3:U958"><span class="mxinfo " id="T3:U959">1</span>-<span class="mxinfo " id="T3:U960"><span class="var type1" id="S46T3U1251">dd</span>/<span class="var type1" id="S7T3U1252">delta</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">    <span class="mxinfo " id="T3:U963"><span class="mxinfo " id="T3:U964"><span class="var type1" id="S4T2U1256">A</span>(<span class="var type1" id="S47T3U1257">i</span>,<span class="mxinfo " id="T3:U967"><span class="var type1" id="S47T3U1259">i</span>+<span class="mxinfo " id="T3:U969">1</span></span>)</span> = <span class="mxinfo " id="T3:U970"><span class="var type1" id="S46T3U1262">dd</span>/<span class="var type1" id="S7T3U1263">delta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T3:U973"><span class="mxinfo " id="T3:U974"><span class="var type1" id="S4T2U1267">A</span>(<span class="mxinfo " id="T3:U976">numel(<span class="var type1" id="S2T1U1270">r</span>)</span>,<span class="mxinfo " id="T3:U978">numel(<span class="var type1" id="S2T1U1273">r</span>)</span>)</span> = <span class="mxinfo " id="T3:U980">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"><span class="mxinfo " id="T1:U981"><span class="var type1" id="S2T1U1277">r</span> = <span class="mxinfo " id="T1:U983"><span class="var type1" id="S4T2U1279">A</span>*<span class="var type1" id="S2T1U1280">r</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="mxinfo " id="T2:U986"><span class="var type1" id="S48T2U1283">R</span> = <span class="mxinfo " id="T2:U988"><span class="mxinfo " id="T2:U989">eye(<span class="mxinfo " id="T3:U990"><span class="mxinfo " id="T3:U991">2</span>*(<span class="mxinfo " id="T3:U992"><span class="mxinfo " id="T3:U993"><span class="mxinfo " id="T3:U994">numel(<span class="var type1" id="S8T1U1294">xl</span>)</span>+<span class="mxinfo " id="T3:U996">numel(<span class="var type1" id="S10T1U1297">xr</span>)</span></span>+<span class="mxinfo " id="T3:U998">numel(<span class="var type1" id="S12T1U1300">xm</span>)</span></span>)</span>)</span>.*<span class="var type1" id="S6T3U1301">R_fakt</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"><span class="mxinfo " id="T2:U1001"><span class="var type1" id="S3T2U1304">Pk</span> = <span class="mxinfo " id="T2:U1003"><span class="mxinfo " id="T2:U1004"><span class="mxinfo " id="T2:U1005"><span class="var type1" id="S4T2U1308">A</span>*<span class="var type1" id="S3T2U1309">Pk</span></span>*<span class="mxinfo " id="T2:U1008"><span class="var type1" id="S4T2U1311">A</span>'</span></span> + <span class="var type1" id="S5T2U1312">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"><span class="mxinfo " id="T1:U1011"><span class="var type1" id="S50T1U1315">y_tilde</span> = <span class="mxinfo " id="T1:U1013"><span class="var type1" id="S44T1U1317">z</span> - <span class="var type1" id="S45T1U1318">zm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line"><span class="mxinfo " id="T2:U1016"><span class="var type1" id="S51T2U1321">K</span> = <span class="mxinfo " id="T2:U1018"><span class="mxinfo " id="T2:U1019"><span class="var type1" id="S3T2U1324">Pk</span>*<span class="mxinfo " id="T2:U1021"><span class="var type1" id="S43T2U1326">H</span>'</span></span>/(<span class="mxinfo " id="T2:U1023"><span class="mxinfo " id="T2:U1024"><span class="mxinfo " id="T2:U1025"><span class="var type1" id="S43T2U1331">H</span>*<span class="var type1" id="S3T2U1332">Pk</span></span>*<span class="mxinfo " id="T2:U1028"><span class="var type1" id="S43T2U1334">H</span>'</span></span> + <span class="var type1" id="S48T2U1335">R</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line"><span class="mxinfo " id="T1:U1031"><span class="var type1" id="S2T1U1338">r</span> = <span class="mxinfo " id="T1:U1033"><span class="var type1" id="S2T1U1340">r</span> + <span class="mxinfo " id="T1:U1035"><span class="var type1" id="S51T2U1342">K</span>*<span class="var type1" id="S50T1U1343">y_tilde</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line"><span class="mxinfo " id="T2:U1038"><span class="var type1" id="S3T2U1346">Pk</span> = <span class="mxinfo " id="T2:U1040">(<span class="mxinfo " id="T2:U1041"><span class="mxinfo " id="T2:U1042">eye(<span class="mxinfo " id="T3:U1043">numel(<span class="var type1" id="S2T1U1354">r</span>)</span>)</span> - <span class="mxinfo " id="T2:U1045"><span class="var type1" id="S51T2U1356">K</span>*<span class="var type1" id="S43T2U1357">H</span></span></span>)*<span class="var type1" id="S3T2U1358">Pk</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="comment">%% Zustandsbegrenzungen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="comment">% Krümmung</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"><span class="mxinfo " id="T3:U1049"><span class="var type1" id="S52T3U1361">kr</span> = <span class="mxinfo " id="T3:U1051">0.75</span></span>; <span class="comment">% bezogen auf Mittellinie, 0.72 entspricht einem minimalen Innenradius von 1m</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S47T3U1365">i</span>=<span class="mxinfo " id="T3:U1053">3</span>:<span class="mxinfo " id="T3:U1054">numel(<span class="var type1" id="S2T1U1370">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line">    <span class="mxinfo " id="T3:U1056"><span class="mxinfo " id="T3:U1057"><span class="var type1" id="S2T1U1374">r</span>(<span class="var type1" id="S47T3U1375">i</span>)</span> = <span class="mxinfo " id="T3:U1060">max(<span class="mxinfo " id="T3:U1061">-<span class="var type1" id="S52T3U1379">kr</span></span>, <span class="mxinfo " id="T3:U1063"><span class="var type1" id="S2T1U1381">r</span>(<span class="var type1" id="S47T3U1382">i</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">    <span class="mxinfo " id="T3:U1066"><span class="mxinfo " id="T3:U1067"><span class="var type1" id="S2T1U1386">r</span>(<span class="var type1" id="S47T3U1387">i</span>)</span> = <span class="mxinfo " id="T3:U1070">min(<span class="var type1" id="S52T3U1390">kr</span>, <span class="mxinfo " id="T3:U1072"><span class="var type1" id="S2T1U1392">r</span>(<span class="var type1" id="S47T3U1393">i</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line"><span class="comment">% y-Wert des ersten Punktes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line"><span class="mxinfo " id="T3:U1075"><span class="var type1" id="S55T3U1396">y_max</span> = <span class="mxinfo " id="T3:U1077">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="mxinfo " id="T3:U1078"><span class="mxinfo " id="T3:U1079"><span class="var type1" id="S2T1U1401">r</span>(<span class="mxinfo " id="T3:U1081">1</span>)</span> =  <span class="mxinfo " id="T3:U1082">max(<span class="mxinfo " id="T3:U1083">-<span class="var type1" id="S55T3U1406">y_max</span></span>, <span class="mxinfo " id="T3:U1085">min(<span class="var type1" id="S55T3U1409">y_max</span>, <span class="mxinfo " id="T3:U1087"><span class="var type1" id="S2T1U1411">r</span>(<span class="mxinfo " id="T3:U1089">1</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"><span class="comment">% Startwinkel </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"><span class="mxinfo " id="T3:U1090"><span class="var type1" id="S56T3U1415">phi_max</span> = <span class="mxinfo " id="T3:U1092">0.78</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line"><span class="mxinfo " id="T3:U1093"><span class="mxinfo " id="T3:U1094"><span class="var type1" id="S2T1U1420">r</span>(<span class="mxinfo " id="T3:U1096">2</span>)</span> =  <span class="mxinfo " id="T3:U1097">max(<span class="mxinfo " id="T3:U1098">-<span class="var type1" id="S56T3U1425">phi_max</span></span>, <span class="mxinfo " id="T3:U1100">min(<span class="var type1" id="S56T3U1428">phi_max</span>, <span class="mxinfo " id="T3:U1102"><span class="var type1" id="S2T1U1430">r</span>(<span class="mxinfo " id="T3:U1104">2</span>)</span>)</span>)</span></span>; <span class="comment">% 45°</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line"></span></span>
</pre>
