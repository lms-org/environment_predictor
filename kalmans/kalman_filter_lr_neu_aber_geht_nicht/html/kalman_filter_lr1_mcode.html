<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">r</span>, <span class="var type1" id="S3T1U4">Pk</span>] = kalman_filter_lr (<span class="mxinfo " id="T2:U3"><span class="mxinfo " id="T2:U4"><span class="var type1" id="S2T2U7">r</span></span></span>, <span class="var type1" id="S4T3U8">delta_x</span>, <span class="var type1" id="S5T3U9">delta_y</span>, <span class="var type1" id="S6T3U10">delta_phi</span>, <span class="mxinfo " id="T1:U9"><span class="mxinfo " id="T1:U10"><span class="var type1" id="S3T1U11">Pk</span></span></span>, <span class="var type1" id="S7T1U12">Q</span>, <span class="var type1" id="S8T3U13">R_fakt</span>, <span class="var type1" id="S9T3U14">delta</span>, <span class="var type1" id="S10T2U15">xl</span>, <span class="var type1" id="S11T2U16">yl</span>, <span class="var type1" id="S12T2U17">xr</span>, <span class="var type1" id="S13T2U18">yr</span>, <span class="var type1" id="S14T2U19">xm</span>, <span class="var type1" id="S15T2U20">ym</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% "kalman_filter_lr" </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% ----Nomenklatur----</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%  * r: Zustandsvektor = [y0, phi0, kappa_1, kappa_2, <span class="keyword">...</span><span class="comment"> , kappa_(n-1)] </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   --&gt; y0: y-Wert des ersten Punktes (x-Wert ist immer 0)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   --&gt; phi0: Anfangssteigung zwischem ersten und zweiten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   --&gt; kappa_i: Krümmungen an den entsprechenden Punkten (Krümmungsdefinition: 1/R, </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   wobei R der Radius des Kreises ist, auf dem der betrachtete Punkt, sein Vorgänger </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   und sein Nachfolger liegen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%  * Pk: Kovarianzmatrix des Zustands dim[n x n], mit n = Dimension des Zustandsvektors</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%  * A: State-Transition-Matrix dim[n x n] (ist zurzeit eine Einheitsmatrix, da noch keine </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%    Messwerte fuer die Eigenbewegung verfügbar sind)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%  * Q: Kovarianz des Zustandsübergangs (Prozessrauschen) dim[n x n] (symmetrische Matrix, mit weg von der </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%    Diagonalen abnehmenden Eintraegen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%  * R_fakt: Unsicherheit der Messwerte (Messrauschen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%  * delta: Abstand der Punkte (delta*n ergibt die Länge des praedizierten Fahrstreifens)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%  * xl, yl: Vektoren mit den Messwerten für die linke Spur</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%  * xr, yr: Vektoren mit den Messwerten für die rechte Spur</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%  ----Grober Ablauf des Algorithmus----</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%  1. Projektion der Punkte von der Mittellinie nach links bzw. rechts</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%  2. Fuer jeden Messpunkt: Berechnung des kleinsten Abstands zum aktuell praedizierten Strassenverlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%  3. Assemblierung der Jakobimatrix fuer die Projektion aus dem Zustandsraum r auf x-y-Koordinaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%  4. Kalman-Filter: Praediktion -&gt; Messwerte einbeziehen -&gt; Update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%  5. Zustandsbegrenzungen einbringen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%% linke Seitenlinie</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">[<span class="mxinfo " id="T2:U21"><span class="var type1" id="S16T2U24">xp</span></span>, <span class="mxinfo " id="T2:U23"><span class="var type1" id="S17T2U25">yp</span></span>, <span class="mxinfo " id="T2:U25"><span class="var type1" id="S18T2U26">phi</span></span>] = <span class="fcn" id="F39N7:B28">projectPoints</span>(<span class="var type1" id="S2T2U29">r</span>, <span class="var type1" id="S9T3U30">delta</span>, 0.38); <span class="comment">%Punkte von Mittellinie nach links projizieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T4:U29"><span class="var type1" id="S20T4U34">P</span> = <span class="mxinfo " id="T4:U31">[<span class="var type1" id="S16T2U37">xp</span>, <span class="var type1" id="S17T2U38">yp</span>, <span class="var type1" id="S18T2U39">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T4:U35"><span class="var type1" id="S21T4U42">D</span> = <span class="mxinfo " id="T4:U37"><span class="mxinfo " id="T3:U38">10000</span>*<span class="mxinfo " id="T4:U39">ones(<span class="mxinfo " id="T3:U40">numel(<span class="var type1" id="S10T2U49">xl</span>)</span>, <span class="mxinfo " id="T3:U42">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S24T3U53">s</span>=<span class="mxinfo " id="T3:U44">1</span>:<span class="mxinfo " id="T3:U45">numel(<span class="var type1" id="S2T2U58">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S25T3U61">m</span>=<span class="mxinfo " id="T3:U48">1</span>:<span class="mxinfo " id="T3:U49">numel(<span class="var type1" id="S10T2U66">xl</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">        <span class="mxinfo " id="T3:U51"><span class="var type1" id="S26T3U69">dist_point</span> = <span class="mxinfo " id="T3:U53">sqrt(<span class="mxinfo " id="T3:U54"><span class="mxinfo " id="T3:U55">(<span class="mxinfo " id="T3:U56"><span class="mxinfo " id="T3:U57"><span class="var type1" id="S20T4U77">P</span>(<span class="var type1" id="S24T3U78">s</span>, <span class="mxinfo " id="T3:U60">1</span>)</span>-(<span class="mxinfo " id="T3:U61"><span class="var type1" id="S10T2U82">xl</span>(<span class="var type1" id="S25T3U83">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U64">(<span class="mxinfo " id="T3:U65"><span class="mxinfo " id="T3:U66"><span class="var type1" id="S20T4U89">P</span>(<span class="var type1" id="S24T3U90">s</span>, <span class="mxinfo " id="T3:U69">2</span>)</span>-(<span class="mxinfo " id="T3:U70"><span class="var type1" id="S11T2U94">yl</span>(<span class="var type1" id="S25T3U95">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U73"><span class="var type1" id="S26T3U100">dist_point</span> &lt; <span class="mxinfo " id="T3:U75"><span class="var type1" id="S21T4U102">D</span>(<span class="var type1" id="S25T3U103">m</span>, <span class="mxinfo " id="T3:U78">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">            <span class="mxinfo " id="T3:U79"><span class="mxinfo " id="T3:U80"><span class="var type1" id="S21T4U108">D</span>(<span class="var type1" id="S25T3U109">m</span>, <span class="mxinfo " id="T3:U83">1</span>)</span> = <span class="var type1" id="S24T3U111">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">            <span class="mxinfo " id="T3:U85"><span class="mxinfo " id="T3:U86"><span class="var type1" id="S21T4U115">D</span>(<span class="var type1" id="S25T3U116">m</span>, <span class="mxinfo " id="T3:U89">2</span>)</span> = <span class="mxinfo " id="T3:U90">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">            <span class="mxinfo " id="T3:U91"><span class="mxinfo " id="T3:U92"><span class="var type1" id="S21T4U122">D</span>(<span class="var type1" id="S25T3U123">m</span>, <span class="mxinfo " id="T3:U95">3</span>)</span> = <span class="var type1" id="S26T3U125">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U97"><span class="var type1" id="S24T3U129">s</span> &gt; <span class="mxinfo " id="T3:U99">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">            [<span class="mxinfo " id="T3:U100"><span class="var type1" id="S28T3U134">dist_line</span></span>, <span class="mxinfo " id="T3:U102"><span class="var type1" id="S29T3U135">lambda</span></span>, <span class="mxinfo " id="T3:U104"><span class="mxinfo " id="T3:U105">~</span></span>] = <span class="fcn" id="F46N2:B138">d_line_point</span>(<span class="mxinfo " id="T11:U106">[<span class="mxinfo " id="T3:U107"><span class="var type1" id="S20T4U142">P</span>(<span class="mxinfo " id="T3:U109"><span class="var type1" id="S24T3U144">s</span>-<span class="mxinfo " id="T3:U111">1</span></span>, <span class="mxinfo " id="T3:U112">1</span>)</span>, <span class="mxinfo " id="T3:U113"><span class="var type1" id="S20T4U148">P</span>(<span class="mxinfo " id="T3:U115"><span class="var type1" id="S24T3U150">s</span>-<span class="mxinfo " id="T3:U117">1</span></span>, <span class="mxinfo " id="T3:U118">2</span>)</span>]</span>, <span class="mxinfo " id="T11:U119">[<span class="mxinfo " id="T3:U120"><span class="var type1" id="S20T4U156">P</span>(<span class="var type1" id="S24T3U157">s</span>, <span class="mxinfo " id="T3:U123">1</span>)</span>, <span class="mxinfo " id="T3:U124"><span class="var type1" id="S20T4U160">P</span>(<span class="var type1" id="S24T3U161">s</span>, <span class="mxinfo " id="T3:U127">2</span>)</span>]</span>, <span class="mxinfo " id="T11:U128">[<span class="mxinfo " id="T3:U129"><span class="var type1" id="S10T2U166">xl</span>(<span class="var type1" id="S25T3U167">m</span>)</span>, <span class="mxinfo " id="T3:U132"><span class="var type1" id="S11T2U169">yl</span>(<span class="var type1" id="S25T3U170">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T5:U135"><span class="var type1" id="S28T3U176">dist_line</span> &lt; <span class="mxinfo " id="T3:U137"><span class="var type1" id="S21T4U178">D</span>(<span class="var type1" id="S25T3U179">m</span>, <span class="mxinfo " id="T3:U140">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T5:U141"><span class="var type1" id="S29T3U182">lambda</span> &gt; <span class="mxinfo " id="T3:U143">0</span></span> &amp;&amp; <span class="mxinfo " id="T5:U144"><span class="var type1" id="S29T3U185">lambda</span> &lt; <span class="mxinfo " id="T3:U146">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">                <span class="mxinfo " id="T3:U147"><span class="mxinfo " id="T3:U148"><span class="var type1" id="S21T4U190">D</span>(<span class="var type1" id="S25T3U191">m</span>, <span class="mxinfo " id="T3:U151">1</span>)</span> = <span class="mxinfo " id="T3:U152"><span class="var type1" id="S24T3U194">s</span>-<span class="mxinfo " id="T3:U154">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">                <span class="mxinfo " id="T3:U155"><span class="mxinfo " id="T3:U156"><span class="var type1" id="S21T4U199">D</span>(<span class="var type1" id="S25T3U200">m</span>, <span class="mxinfo " id="T3:U159">2</span>)</span> = <span class="var type1" id="S29T3U202">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">                <span class="mxinfo " id="T3:U161"><span class="mxinfo " id="T3:U162"><span class="var type1" id="S21T4U206">D</span>(<span class="var type1" id="S25T3U207">m</span>, <span class="mxinfo " id="T3:U165">3</span>)</span> = <span class="var type1" id="S28T3U209">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T12:U167"><span class="var type1" id="S31T12U212">ind</span> = (<span class="mxinfo " id="T12:U169"><span class="mxinfo " id="T12:U170"><span class="mxinfo " id="T2:U171"><span class="var type1" id="S21T4U217">D</span>(:, <span class="mxinfo " id="T3:U173">1</span>)</span> == <span class="mxinfo " id="T3:U174">numel(<span class="var type1" id="S2T2U222">r</span>)</span></span> | <span class="mxinfo " id="T12:U176"><span class="mxinfo " id="T2:U177"><span class="var type1" id="S21T4U225">D</span>(:, <span class="mxinfo " id="T3:U179">3</span>)</span> &gt; <span class="mxinfo " id="T3:U180">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T2:U181"><span class="var type1" id="S10T2U232">xl</span>(<span class="var type1" id="S31T12U233">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="mxinfo " id="T2:U184"><span class="var type1" id="S11T2U239">yl</span>(<span class="var type1" id="S31T12U240">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T4:U187"><span class="var type1" id="S21T4U246">D</span>(<span class="var type1" id="S31T12U247">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% Messmatrix, Mess- und Erwartungsvektor bauen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T1:U190"><span class="var type1" id="S32T1U253">Hl</span> = <span class="mxinfo " id="T1:U192"><span class="fcn" id="F88N6:B255">messmatrix</span>(<span class="var type1" id="S20T4U256">P</span>, <span class="var type1" id="S2T2U257">r</span>, <span class="var type1" id="S9T3U258">delta</span>, <span class="mxinfo " id="T2:U196"><span class="var type1" id="S21T4U260">D</span>(:, <span class="mxinfo " id="T3:U198">1</span>)</span>, <span class="mxinfo " id="T2:U199"><span class="var type1" id="S21T4U264">D</span>(:, <span class="mxinfo " id="T3:U201">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T2:U202"><span class="var type1" id="S34T2U269">zl</span> =  <span class="mxinfo " id="T2:U204">zeros(<span class="mxinfo " id="T3:U205"><span class="mxinfo " id="T3:U206">2</span>*<span class="mxinfo " id="T3:U207">numel(<span class="var type1" id="S10T2U276">xl</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T2:U209"><span class="var type1" id="S36T2U280">zml</span> = <span class="mxinfo " id="T2:U211">zeros(<span class="mxinfo " id="T3:U212"><span class="mxinfo " id="T3:U213">2</span>*<span class="mxinfo " id="T3:U214">numel(<span class="var type1" id="S10T2U287">xl</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T3:U216"><span class="var type1" id="S37T3U291">count</span> = <span class="mxinfo " id="T3:U218">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S25T3U295">m</span>=<span class="mxinfo " id="T3:U220">1</span>:<span class="mxinfo " id="T3:U221">numel(<span class="var type1" id="S10T2U300">xl</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">        <span class="mxinfo " id="T3:U223"><span class="mxinfo " id="T3:U224"><span class="var type1" id="S34T2U304">zl</span>(<span class="var type1" id="S37T3U305">count</span>)</span> = <span class="mxinfo " id="T3:U227"><span class="var type1" id="S10T2U307">xl</span>(<span class="var type1" id="S25T3U308">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line">        <span class="mxinfo " id="T3:U230"><span class="mxinfo " id="T3:U231"><span class="var type1" id="S34T2U312">zl</span>(<span class="mxinfo " id="T3:U233"><span class="var type1" id="S37T3U314">count</span> + <span class="mxinfo " id="T3:U235">1</span></span>)</span> = <span class="mxinfo " id="T3:U236"><span class="var type1" id="S11T2U317">yl</span>(<span class="var type1" id="S25T3U318">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line">        <span class="mxinfo " id="T3:U239"><span class="mxinfo " id="T3:U240"><span class="var type1" id="S36T2U322">zml</span>(<span class="var type1" id="S37T3U323">count</span>)</span>     = <span class="mxinfo " id="T3:U243"><span class="mxinfo " id="T3:U244"><span class="var type1" id="S20T4U326">P</span>(<span class="mxinfo " id="T3:U246"><span class="var type1" id="S21T4U328">D</span>(<span class="var type1" id="S25T3U329">m</span>, <span class="mxinfo " id="T3:U249">1</span>)</span>, <span class="mxinfo " id="T3:U250">1</span>)</span> + <span class="mxinfo " id="T3:U251"><span class="mxinfo " id="T3:U252"><span class="var type1" id="S21T4U334">D</span>(<span class="var type1" id="S25T3U335">m</span>, <span class="mxinfo " id="T3:U255">2</span>)</span> * (<span class="mxinfo " id="T3:U256"><span class="mxinfo " id="T3:U257"><span class="var type1" id="S20T4U340">P</span>(<span class="mxinfo " id="T3:U259"><span class="mxinfo " id="T3:U260"><span class="var type1" id="S21T4U343">D</span>(<span class="var type1" id="S25T3U344">m</span>, <span class="mxinfo " id="T3:U263">1</span>)</span>+<span class="mxinfo " id="T3:U264">1</span></span>, <span class="mxinfo " id="T3:U265">1</span>)</span> - <span class="mxinfo " id="T3:U266"><span class="var type1" id="S20T4U349">P</span>(<span class="mxinfo " id="T3:U268"><span class="var type1" id="S21T4U351">D</span>(<span class="var type1" id="S25T3U352">m</span>, <span class="mxinfo " id="T3:U271">1</span>)</span>, <span class="mxinfo " id="T3:U272">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">        <span class="mxinfo " id="T3:U273"><span class="mxinfo " id="T3:U274"><span class="var type1" id="S36T2U358">zml</span>(<span class="mxinfo " id="T3:U276"><span class="var type1" id="S37T3U360">count</span> + <span class="mxinfo " id="T3:U278">1</span></span>)</span> = <span class="mxinfo " id="T3:U279"><span class="mxinfo " id="T3:U280"><span class="var type1" id="S20T4U364">P</span>(<span class="mxinfo " id="T3:U282"><span class="var type1" id="S21T4U366">D</span>(<span class="var type1" id="S25T3U367">m</span>, <span class="mxinfo " id="T3:U285">1</span>)</span>, <span class="mxinfo " id="T3:U286">2</span>)</span> + <span class="mxinfo " id="T3:U287"><span class="mxinfo " id="T3:U288"><span class="var type1" id="S21T4U372">D</span>(<span class="var type1" id="S25T3U373">m</span>, <span class="mxinfo " id="T3:U291">2</span>)</span> * (<span class="mxinfo " id="T3:U292"><span class="mxinfo " id="T3:U293"><span class="var type1" id="S20T4U378">P</span>(<span class="mxinfo " id="T3:U295"><span class="mxinfo " id="T3:U296"><span class="var type1" id="S21T4U381">D</span>(<span class="var type1" id="S25T3U382">m</span>, <span class="mxinfo " id="T3:U299">1</span>)</span>+<span class="mxinfo " id="T3:U300">1</span></span>, <span class="mxinfo " id="T3:U301">2</span>)</span> - <span class="mxinfo " id="T3:U302"><span class="var type1" id="S20T4U387">P</span>(<span class="mxinfo " id="T3:U304"><span class="var type1" id="S21T4U389">D</span>(<span class="var type1" id="S25T3U390">m</span>, <span class="mxinfo " id="T3:U307">1</span>)</span>, <span class="mxinfo " id="T3:U308">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line">        <span class="mxinfo " id="T3:U309"><span class="var type1" id="S37T3U395">count</span> = <span class="mxinfo " id="T3:U311"><span class="var type1" id="S37T3U397">count</span> + <span class="mxinfo " id="T3:U313">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%% rechte Seitenlinie</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">[<span class="mxinfo " id="T2:U314"><span class="var type1" id="S16T2U402">xp</span></span>, <span class="mxinfo " id="T2:U316"><span class="var type1" id="S17T2U403">yp</span></span>, <span class="mxinfo " id="T2:U318"><span class="var type1" id="S18T2U404">phi</span></span>] = <span class="fcn" id="F89N7:B406">projectPoints</span>(<span class="var type1" id="S2T2U407">r</span>, <span class="var type1" id="S9T3U408">delta</span>, -0.38); <span class="comment">%Punkte von Mittellinie nach rechts projizieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo " id="T4:U322"><span class="var type1" id="S20T4U413">P</span> = <span class="mxinfo " id="T4:U324">[<span class="var type1" id="S16T2U416">xp</span>, <span class="var type1" id="S17T2U417">yp</span>, <span class="var type1" id="S18T2U418">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T4:U328"><span class="var type1" id="S21T4U421">D</span> = <span class="mxinfo " id="T4:U330"><span class="mxinfo " id="T3:U331">10000</span>*<span class="mxinfo " id="T4:U332">ones(<span class="mxinfo " id="T3:U333">numel(<span class="var type1" id="S12T2U428">xr</span>)</span>, <span class="mxinfo " id="T3:U335">3</span>)</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S24T3U432">s</span>=<span class="mxinfo " id="T3:U337">1</span>:<span class="mxinfo " id="T3:U338">numel(<span class="var type1" id="S2T2U437">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S25T3U440">m</span>=<span class="mxinfo " id="T3:U341">1</span>:<span class="mxinfo " id="T3:U342">numel(<span class="var type1" id="S12T2U445">xr</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">        <span class="mxinfo " id="T3:U344"><span class="var type1" id="S26T3U448">dist_point</span> = <span class="mxinfo " id="T3:U346">sqrt(<span class="mxinfo " id="T3:U347"><span class="mxinfo " id="T3:U348">(<span class="mxinfo " id="T3:U349"><span class="mxinfo " id="T3:U350"><span class="var type1" id="S20T4U456">P</span>(<span class="var type1" id="S24T3U457">s</span>, <span class="mxinfo " id="T3:U353">1</span>)</span>-(<span class="mxinfo " id="T3:U354"><span class="var type1" id="S12T2U461">xr</span>(<span class="var type1" id="S25T3U462">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U357">(<span class="mxinfo " id="T3:U358"><span class="mxinfo " id="T3:U359"><span class="var type1" id="S20T4U468">P</span>(<span class="var type1" id="S24T3U469">s</span>, <span class="mxinfo " id="T3:U362">2</span>)</span>-(<span class="mxinfo " id="T3:U363"><span class="var type1" id="S13T2U473">yr</span>(<span class="var type1" id="S25T3U474">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U366"><span class="var type1" id="S26T3U479">dist_point</span> &lt; <span class="mxinfo " id="T3:U368"><span class="var type1" id="S21T4U481">D</span>(<span class="var type1" id="S25T3U482">m</span>, <span class="mxinfo " id="T3:U371">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line">            <span class="mxinfo " id="T3:U372"><span class="mxinfo " id="T3:U373"><span class="var type1" id="S21T4U487">D</span>(<span class="var type1" id="S25T3U488">m</span>, <span class="mxinfo " id="T3:U376">1</span>)</span> = <span class="var type1" id="S24T3U490">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">            <span class="mxinfo " id="T3:U378"><span class="mxinfo " id="T3:U379"><span class="var type1" id="S21T4U494">D</span>(<span class="var type1" id="S25T3U495">m</span>, <span class="mxinfo " id="T3:U382">2</span>)</span> = <span class="mxinfo " id="T3:U383">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">            <span class="mxinfo " id="T3:U384"><span class="mxinfo " id="T3:U385"><span class="var type1" id="S21T4U501">D</span>(<span class="var type1" id="S25T3U502">m</span>, <span class="mxinfo " id="T3:U388">3</span>)</span> = <span class="var type1" id="S26T3U504">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U390"><span class="var type1" id="S24T3U508">s</span> &gt; <span class="mxinfo " id="T3:U392">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">            [<span class="mxinfo " id="T3:U393"><span class="var type1" id="S28T3U513">dist_line</span></span>, <span class="mxinfo " id="T3:U395"><span class="var type1" id="S29T3U514">lambda</span></span>, <span class="mxinfo " id="T3:U397"><span class="mxinfo " id="T3:U398">~</span></span>] = <span class="fcn" id="F46N2:B517">d_line_point</span>(<span class="mxinfo " id="T11:U399">[<span class="mxinfo " id="T3:U400"><span class="var type1" id="S20T4U521">P</span>(<span class="mxinfo " id="T3:U402"><span class="var type1" id="S24T3U523">s</span>-<span class="mxinfo " id="T3:U404">1</span></span>, <span class="mxinfo " id="T3:U405">1</span>)</span>, <span class="mxinfo " id="T3:U406"><span class="var type1" id="S20T4U527">P</span>(<span class="mxinfo " id="T3:U408"><span class="var type1" id="S24T3U529">s</span>-<span class="mxinfo " id="T3:U410">1</span></span>, <span class="mxinfo " id="T3:U411">2</span>)</span>]</span>, <span class="mxinfo " id="T11:U412">[<span class="mxinfo " id="T3:U413"><span class="var type1" id="S20T4U535">P</span>(<span class="var type1" id="S24T3U536">s</span>, <span class="mxinfo " id="T3:U416">1</span>)</span>, <span class="mxinfo " id="T3:U417"><span class="var type1" id="S20T4U539">P</span>(<span class="var type1" id="S24T3U540">s</span>, <span class="mxinfo " id="T3:U420">2</span>)</span>]</span>, <span class="mxinfo " id="T11:U421">[<span class="mxinfo " id="T3:U422"><span class="var type1" id="S12T2U545">xr</span>(<span class="var type1" id="S25T3U546">m</span>)</span>, <span class="mxinfo " id="T3:U425"><span class="var type1" id="S13T2U548">yr</span>(<span class="var type1" id="S25T3U549">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T5:U428"><span class="var type1" id="S28T3U555">dist_line</span> &lt; <span class="mxinfo " id="T3:U430"><span class="var type1" id="S21T4U557">D</span>(<span class="var type1" id="S25T3U558">m</span>, <span class="mxinfo " id="T3:U433">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T5:U434"><span class="var type1" id="S29T3U561">lambda</span> &gt; <span class="mxinfo " id="T3:U436">0</span></span> &amp;&amp; <span class="mxinfo " id="T5:U437"><span class="var type1" id="S29T3U564">lambda</span> &lt; <span class="mxinfo " id="T3:U439">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">                <span class="mxinfo " id="T3:U440"><span class="mxinfo " id="T3:U441"><span class="var type1" id="S21T4U569">D</span>(<span class="var type1" id="S25T3U570">m</span>, <span class="mxinfo " id="T3:U444">1</span>)</span> = <span class="mxinfo " id="T3:U445"><span class="var type1" id="S24T3U573">s</span>-<span class="mxinfo " id="T3:U447">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">                <span class="mxinfo " id="T3:U448"><span class="mxinfo " id="T3:U449"><span class="var type1" id="S21T4U578">D</span>(<span class="var type1" id="S25T3U579">m</span>, <span class="mxinfo " id="T3:U452">2</span>)</span> = <span class="var type1" id="S29T3U581">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line">                <span class="mxinfo " id="T3:U454"><span class="mxinfo " id="T3:U455"><span class="var type1" id="S21T4U585">D</span>(<span class="var type1" id="S25T3U586">m</span>, <span class="mxinfo " id="T3:U458">3</span>)</span> = <span class="var type1" id="S28T3U588">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">% ind = ((D(:, 1) == numel(r) &amp; D(:, 2) == 0) | D(:, 3) &gt; 0.5 );</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T12:U460"><span class="var type1" id="S31T12U591">ind</span> = (<span class="mxinfo " id="T12:U462"><span class="mxinfo " id="T12:U463"><span class="mxinfo " id="T2:U464"><span class="var type1" id="S21T4U596">D</span>(:, <span class="mxinfo " id="T3:U466">1</span>)</span> == <span class="mxinfo " id="T3:U467">numel(<span class="var type1" id="S2T2U601">r</span>)</span></span> | <span class="mxinfo " id="T12:U469"><span class="mxinfo " id="T2:U470"><span class="var type1" id="S21T4U604">D</span>(:, <span class="mxinfo " id="T3:U472">3</span>)</span> &gt; <span class="mxinfo " id="T3:U473">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T2:U474"><span class="var type1" id="S12T2U611">xr</span>(<span class="var type1" id="S31T12U612">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T2:U477"><span class="var type1" id="S13T2U618">yr</span>(<span class="var type1" id="S31T12U619">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T4:U480"><span class="var type1" id="S21T4U625">D</span>(<span class="var type1" id="S31T12U626">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">% Messmatrix, Mess- und Erwartungsvektor bauen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="mxinfo " id="T1:U483"><span class="var type1" id="S38T1U632">Hr</span> = <span class="mxinfo " id="T1:U485"><span class="fcn" id="F88N6:B634">messmatrix</span>(<span class="var type1" id="S20T4U635">P</span>, <span class="var type1" id="S2T2U636">r</span>, <span class="var type1" id="S9T3U637">delta</span>, <span class="mxinfo " id="T2:U489"><span class="var type1" id="S21T4U639">D</span>(:, <span class="mxinfo " id="T3:U491">1</span>)</span>, <span class="mxinfo " id="T2:U492"><span class="var type1" id="S21T4U643">D</span>(:, <span class="mxinfo " id="T3:U494">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T2:U495"><span class="var type1" id="S39T2U648">zr</span> =  <span class="mxinfo " id="T2:U497">zeros(<span class="mxinfo " id="T3:U498"><span class="mxinfo " id="T3:U499">2</span>*<span class="mxinfo " id="T3:U500">numel(<span class="var type1" id="S12T2U655">xr</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo " id="T2:U502"><span class="var type1" id="S40T2U659">zmr</span> = <span class="mxinfo " id="T2:U504">zeros(<span class="mxinfo " id="T3:U505"><span class="mxinfo " id="T3:U506">2</span>*<span class="mxinfo " id="T3:U507">numel(<span class="var type1" id="S12T2U666">xr</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo " id="T3:U509"><span class="var type1" id="S37T3U670">count</span> = <span class="mxinfo " id="T3:U511">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S25T3U674">m</span>=<span class="mxinfo " id="T3:U513">1</span>:<span class="mxinfo " id="T3:U514">numel(<span class="var type1" id="S12T2U679">xr</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line">        <span class="mxinfo " id="T3:U516"><span class="mxinfo " id="T3:U517"><span class="var type1" id="S39T2U683">zr</span>(<span class="var type1" id="S37T3U684">count</span>)</span> = <span class="mxinfo " id="T3:U520"><span class="var type1" id="S12T2U686">xr</span>(<span class="var type1" id="S25T3U687">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo " id="T3:U523"><span class="mxinfo " id="T3:U524"><span class="var type1" id="S39T2U691">zr</span>(<span class="mxinfo " id="T3:U526"><span class="var type1" id="S37T3U693">count</span> + <span class="mxinfo " id="T3:U528">1</span></span>)</span> = <span class="mxinfo " id="T3:U529"><span class="var type1" id="S13T2U696">yr</span>(<span class="var type1" id="S25T3U697">m</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line">        <span class="mxinfo " id="T3:U532"><span class="mxinfo " id="T3:U533"><span class="var type1" id="S40T2U701">zmr</span>(<span class="var type1" id="S37T3U702">count</span>)</span>     = <span class="mxinfo " id="T3:U536"><span class="mxinfo " id="T3:U537"><span class="var type1" id="S20T4U705">P</span>(<span class="mxinfo " id="T3:U539"><span class="var type1" id="S21T4U707">D</span>(<span class="var type1" id="S25T3U708">m</span>, <span class="mxinfo " id="T3:U542">1</span>)</span>, <span class="mxinfo " id="T3:U543">1</span>)</span> + <span class="mxinfo " id="T3:U544"><span class="mxinfo " id="T3:U545"><span class="var type1" id="S21T4U713">D</span>(<span class="var type1" id="S25T3U714">m</span>, <span class="mxinfo " id="T3:U548">2</span>)</span> * (<span class="mxinfo " id="T3:U549"><span class="mxinfo " id="T3:U550"><span class="var type1" id="S20T4U719">P</span>(<span class="mxinfo " id="T3:U552"><span class="mxinfo " id="T3:U553"><span class="var type1" id="S21T4U722">D</span>(<span class="var type1" id="S25T3U723">m</span>, <span class="mxinfo " id="T3:U556">1</span>)</span>+<span class="mxinfo " id="T3:U557">1</span></span>, <span class="mxinfo " id="T3:U558">1</span>)</span> - <span class="mxinfo " id="T3:U559"><span class="var type1" id="S20T4U728">P</span>(<span class="mxinfo " id="T3:U561"><span class="var type1" id="S21T4U730">D</span>(<span class="var type1" id="S25T3U731">m</span>, <span class="mxinfo " id="T3:U564">1</span>)</span>, <span class="mxinfo " id="T3:U565">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo " id="T3:U566"><span class="mxinfo " id="T3:U567"><span class="var type1" id="S40T2U737">zmr</span>(<span class="mxinfo " id="T3:U569"><span class="var type1" id="S37T3U739">count</span> + <span class="mxinfo " id="T3:U571">1</span></span>)</span> = <span class="mxinfo " id="T3:U572"><span class="mxinfo " id="T3:U573"><span class="var type1" id="S20T4U743">P</span>(<span class="mxinfo " id="T3:U575"><span class="var type1" id="S21T4U745">D</span>(<span class="var type1" id="S25T3U746">m</span>, <span class="mxinfo " id="T3:U578">1</span>)</span>, <span class="mxinfo " id="T3:U579">2</span>)</span> + <span class="mxinfo " id="T3:U580"><span class="mxinfo " id="T3:U581"><span class="var type1" id="S21T4U751">D</span>(<span class="var type1" id="S25T3U752">m</span>, <span class="mxinfo " id="T3:U584">2</span>)</span> * (<span class="mxinfo " id="T3:U585"><span class="mxinfo " id="T3:U586"><span class="var type1" id="S20T4U757">P</span>(<span class="mxinfo " id="T3:U588"><span class="mxinfo " id="T3:U589"><span class="var type1" id="S21T4U760">D</span>(<span class="var type1" id="S25T3U761">m</span>, <span class="mxinfo " id="T3:U592">1</span>)</span>+<span class="mxinfo " id="T3:U593">1</span></span>, <span class="mxinfo " id="T3:U594">2</span>)</span> - <span class="mxinfo " id="T3:U595"><span class="var type1" id="S20T4U766">P</span>(<span class="mxinfo " id="T3:U597"><span class="var type1" id="S21T4U768">D</span>(<span class="var type1" id="S25T3U769">m</span>, <span class="mxinfo " id="T3:U600">1</span>)</span>, <span class="mxinfo " id="T3:U601">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line">        <span class="mxinfo " id="T3:U602"><span class="var type1" id="S37T3U774">count</span> = <span class="mxinfo " id="T3:U604"><span class="var type1" id="S37T3U776">count</span> + <span class="mxinfo " id="T3:U606">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">%% Mittellinie</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line">[<span class="mxinfo " id="T2:U607"><span class="var type1" id="S16T2U781">xp</span></span>, <span class="mxinfo " id="T2:U609"><span class="var type1" id="S17T2U782">yp</span></span>, <span class="mxinfo " id="T2:U611"><span class="var type1" id="S18T2U783">phi</span></span>] = <span class="fcn" id="F17N4:B785">getPointsFromState</span>(<span class="var type1" id="S2T2U786">r</span>, <span class="var type1" id="S9T3U787">delta</span>); </span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T4:U615"><span class="var type1" id="S20T4U790">P</span> = <span class="mxinfo " id="T4:U617">[<span class="var type1" id="S16T2U793">xp</span>, <span class="var type1" id="S17T2U794">yp</span>, <span class="var type1" id="S18T2U795">phi</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="mxinfo " id="T4:U621"><span class="var type1" id="S21T4U798">D</span> = <span class="mxinfo " id="T4:U623"><span class="mxinfo " id="T3:U624">10000</span>*<span class="mxinfo " id="T4:U625">ones(<span class="mxinfo " id="T3:U626">numel(<span class="var type1" id="S14T2U805">xm</span>)</span>, <span class="mxinfo " id="T3:U628">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="comment">% Fuer jeden Messpunkt den nähesten Punkt der aktuellen Praediktion finden </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S24T3U809">s</span>=<span class="mxinfo " id="T3:U630">1</span>:<span class="mxinfo " id="T3:U631">numel(<span class="var type1" id="S2T2U814">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line">   <span class="keyword">for</span> <span class="var type1" id="S25T3U817">m</span>=<span class="mxinfo " id="T3:U634">1</span>:<span class="mxinfo " id="T3:U635">numel(<span class="var type1" id="S14T2U822">xm</span>)</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line">        <span class="mxinfo " id="T3:U637"><span class="var type1" id="S26T3U825">dist_point</span> = <span class="mxinfo " id="T3:U639">sqrt(<span class="mxinfo " id="T3:U640"><span class="mxinfo " id="T3:U641">(<span class="mxinfo " id="T3:U642"><span class="mxinfo " id="T3:U643"><span class="var type1" id="S20T4U833">P</span>(<span class="var type1" id="S24T3U834">s</span>, <span class="mxinfo " id="T3:U646">1</span>)</span>-(<span class="mxinfo " id="T3:U647"><span class="var type1" id="S14T2U838">xm</span>(<span class="var type1" id="S25T3U839">m</span>)</span>)</span>)^2</span> + <span class="mxinfo " id="T3:U650">(<span class="mxinfo " id="T3:U651"><span class="mxinfo " id="T3:U652"><span class="var type1" id="S20T4U845">P</span>(<span class="var type1" id="S24T3U846">s</span>, <span class="mxinfo " id="T3:U655">2</span>)</span>-(<span class="mxinfo " id="T3:U656"><span class="var type1" id="S15T2U850">ym</span>(<span class="var type1" id="S25T3U851">m</span>)</span>)</span>)^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U659"><span class="var type1" id="S26T3U856">dist_point</span> &lt; <span class="mxinfo " id="T3:U661"><span class="var type1" id="S21T4U858">D</span>(<span class="var type1" id="S25T3U859">m</span>, <span class="mxinfo " id="T3:U664">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line">            <span class="mxinfo " id="T3:U665"><span class="mxinfo " id="T3:U666"><span class="var type1" id="S21T4U864">D</span>(<span class="var type1" id="S25T3U865">m</span>, <span class="mxinfo " id="T3:U669">1</span>)</span> = <span class="var type1" id="S24T3U867">s</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line">            <span class="mxinfo " id="T3:U671"><span class="mxinfo " id="T3:U672"><span class="var type1" id="S21T4U871">D</span>(<span class="var type1" id="S25T3U872">m</span>, <span class="mxinfo " id="T3:U675">2</span>)</span> = <span class="mxinfo " id="T3:U676">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line">            <span class="mxinfo " id="T3:U677"><span class="mxinfo " id="T3:U678"><span class="var type1" id="S21T4U878">D</span>(<span class="var type1" id="S25T3U879">m</span>, <span class="mxinfo " id="T3:U681">3</span>)</span> = <span class="var type1" id="S26T3U881">dist_point</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line">        <span class="keyword">end</span>            </span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T5:U683"><span class="var type1" id="S24T3U885">s</span> &gt; <span class="mxinfo " id="T3:U685">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line">            [<span class="mxinfo " id="T3:U686"><span class="var type1" id="S28T3U890">dist_line</span></span>, <span class="mxinfo " id="T3:U688"><span class="var type1" id="S29T3U891">lambda</span></span>, <span class="mxinfo " id="T3:U690"><span class="mxinfo " id="T3:U691">~</span></span>] = <span class="fcn" id="F46N2:B894">d_line_point</span>(<span class="mxinfo " id="T11:U692">[<span class="mxinfo " id="T3:U693"><span class="var type1" id="S20T4U898">P</span>(<span class="mxinfo " id="T3:U695"><span class="var type1" id="S24T3U900">s</span>-<span class="mxinfo " id="T3:U697">1</span></span>, <span class="mxinfo " id="T3:U698">1</span>)</span>, <span class="mxinfo " id="T3:U699"><span class="var type1" id="S20T4U904">P</span>(<span class="mxinfo " id="T3:U701"><span class="var type1" id="S24T3U906">s</span>-<span class="mxinfo " id="T3:U703">1</span></span>, <span class="mxinfo " id="T3:U704">2</span>)</span>]</span>, <span class="mxinfo " id="T11:U705">[<span class="mxinfo " id="T3:U706"><span class="var type1" id="S20T4U912">P</span>(<span class="var type1" id="S24T3U913">s</span>, <span class="mxinfo " id="T3:U709">1</span>)</span>, <span class="mxinfo " id="T3:U710"><span class="var type1" id="S20T4U916">P</span>(<span class="var type1" id="S24T3U917">s</span>, <span class="mxinfo " id="T3:U713">2</span>)</span>]</span>, <span class="mxinfo " id="T11:U714">[<span class="mxinfo " id="T3:U715"><span class="var type1" id="S14T2U922">xm</span>(<span class="var type1" id="S25T3U923">m</span>)</span>, <span class="mxinfo " id="T3:U718"><span class="var type1" id="S15T2U925">ym</span>(<span class="var type1" id="S25T3U926">m</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T5:U721"><span class="var type1" id="S28T3U932">dist_line</span> &lt; <span class="mxinfo " id="T3:U723"><span class="var type1" id="S21T4U934">D</span>(<span class="var type1" id="S25T3U935">m</span>, <span class="mxinfo " id="T3:U726">3</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T5:U727"><span class="var type1" id="S29T3U938">lambda</span> &gt; <span class="mxinfo " id="T3:U729">0</span></span> &amp;&amp; <span class="mxinfo " id="T5:U730"><span class="var type1" id="S29T3U941">lambda</span> &lt; <span class="mxinfo " id="T3:U732">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line">                <span class="mxinfo " id="T3:U733"><span class="mxinfo " id="T3:U734"><span class="var type1" id="S21T4U946">D</span>(<span class="var type1" id="S25T3U947">m</span>, <span class="mxinfo " id="T3:U737">1</span>)</span> = <span class="mxinfo " id="T3:U738"><span class="var type1" id="S24T3U950">s</span>-<span class="mxinfo " id="T3:U740">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line">                <span class="mxinfo " id="T3:U741"><span class="mxinfo " id="T3:U742"><span class="var type1" id="S21T4U955">D</span>(<span class="var type1" id="S25T3U956">m</span>, <span class="mxinfo " id="T3:U745">2</span>)</span> = <span class="var type1" id="S29T3U958">lambda</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line">                <span class="mxinfo " id="T3:U747"><span class="mxinfo " id="T3:U748"><span class="var type1" id="S21T4U962">D</span>(<span class="var type1" id="S25T3U963">m</span>, <span class="mxinfo " id="T3:U751">3</span>)</span> = <span class="var type1" id="S28T3U965">dist_line</span></span>;              </span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">end</span>         </span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line">    <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"><span class="comment">% Messpunkte ausfiltern, die vor dem letzten prädizierten Punkt oder zu weit entfernt liegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="mxinfo " id="T12:U753"><span class="var type1" id="S31T12U968">ind</span> = (<span class="mxinfo " id="T12:U755"><span class="mxinfo " id="T12:U756"><span class="mxinfo " id="T2:U757"><span class="var type1" id="S21T4U973">D</span>(:, <span class="mxinfo " id="T3:U759">1</span>)</span> == <span class="mxinfo " id="T3:U760">numel(<span class="var type1" id="S2T2U978">r</span>)</span></span> | <span class="mxinfo " id="T12:U762"><span class="mxinfo " id="T2:U763"><span class="var type1" id="S21T4U981">D</span>(:, <span class="mxinfo " id="T3:U765">3</span>)</span> &gt; <span class="mxinfo " id="T3:U766">0.5</span></span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo " id="T2:U767"><span class="var type1" id="S14T2U988">xm</span>(<span class="var type1" id="S31T12U989">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo " id="T2:U770"><span class="var type1" id="S15T2U995">ym</span>(<span class="var type1" id="S31T12U996">ind</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo " id="T4:U773"><span class="var type1" id="S21T4U1002">D</span>(<span class="var type1" id="S31T12U1003">ind</span>, :) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line"><span class="comment">% Messmatrix, Mess- und Erwartungsvektor bauen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line"><span class="mxinfo " id="T1:U776"><span class="var type1" id="S42T1U1009">Hm</span> = <span class="mxinfo " id="T1:U778"><span class="fcn" id="F88N6:B1011">messmatrix</span>(<span class="var type1" id="S20T4U1012">P</span>, <span class="var type1" id="S2T2U1013">r</span>, <span class="var type1" id="S9T3U1014">delta</span>, <span class="mxinfo " id="T2:U782"><span class="var type1" id="S21T4U1016">D</span>(:, <span class="mxinfo " id="T3:U784">1</span>)</span>, <span class="mxinfo " id="T2:U785"><span class="var type1" id="S21T4U1020">D</span>(:, <span class="mxinfo " id="T3:U787">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo " id="T2:U788"><span class="var type1" id="S43T2U1025">z_m</span> =  <span class="mxinfo " id="T2:U790">zeros(<span class="mxinfo " id="T3:U791"><span class="mxinfo " id="T3:U792">2</span>*<span class="mxinfo " id="T3:U793">numel(<span class="var type1" id="S14T2U1032">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo " id="T2:U795"><span class="var type1" id="S44T2U1036">zmm</span> = <span class="mxinfo " id="T2:U797">zeros(<span class="mxinfo " id="T3:U798"><span class="mxinfo " id="T3:U799">2</span>*<span class="mxinfo " id="T3:U800">numel(<span class="var type1" id="S14T2U1043">xm</span>)</span></span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo " id="T3:U802"><span class="var type1" id="S37T3U1047">count</span> = <span class="mxinfo " id="T3:U804">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S25T3U1051">m</span>=<span class="mxinfo " id="T3:U806">1</span>:<span class="mxinfo " id="T3:U807">numel(<span class="var type1" id="S14T2U1056">xm</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">        <span class="mxinfo " id="T3:U809"><span class="mxinfo " id="T3:U810"><span class="var type1" id="S43T2U1060">z_m</span>(<span class="var type1" id="S37T3U1061">count</span>)</span> = <span class="mxinfo " id="T3:U813"><span class="var type1" id="S14T2U1063">xm</span>(<span class="var type1" id="S25T3U1064">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">        <span class="mxinfo " id="T3:U816"><span class="mxinfo " id="T3:U817"><span class="var type1" id="S43T2U1068">z_m</span>(<span class="mxinfo " id="T3:U819"><span class="var type1" id="S37T3U1070">count</span> + <span class="mxinfo " id="T3:U821">1</span></span>)</span> = <span class="mxinfo " id="T3:U822"><span class="var type1" id="S15T2U1073">ym</span>(<span class="var type1" id="S25T3U1074">m</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">        <span class="mxinfo " id="T3:U825"><span class="mxinfo " id="T3:U826"><span class="var type1" id="S44T2U1078">zmm</span>(<span class="var type1" id="S37T3U1079">count</span>)</span>     = <span class="mxinfo " id="T3:U829"><span class="mxinfo " id="T3:U830"><span class="var type1" id="S20T4U1082">P</span>(<span class="mxinfo " id="T3:U832"><span class="var type1" id="S21T4U1084">D</span>(<span class="var type1" id="S25T3U1085">m</span>, <span class="mxinfo " id="T3:U835">1</span>)</span>, <span class="mxinfo " id="T3:U836">1</span>)</span> + <span class="mxinfo " id="T3:U837"><span class="mxinfo " id="T3:U838"><span class="var type1" id="S21T4U1090">D</span>(<span class="var type1" id="S25T3U1091">m</span>, <span class="mxinfo " id="T3:U841">2</span>)</span> * (<span class="mxinfo " id="T3:U842"><span class="mxinfo " id="T3:U843"><span class="var type1" id="S20T4U1096">P</span>(<span class="mxinfo " id="T3:U845"><span class="mxinfo " id="T3:U846"><span class="var type1" id="S21T4U1099">D</span>(<span class="var type1" id="S25T3U1100">m</span>, <span class="mxinfo " id="T3:U849">1</span>)</span>+<span class="mxinfo " id="T3:U850">1</span></span>, <span class="mxinfo " id="T3:U851">1</span>)</span> - <span class="mxinfo " id="T3:U852"><span class="var type1" id="S20T4U1105">P</span>(<span class="mxinfo " id="T3:U854"><span class="var type1" id="S21T4U1107">D</span>(<span class="var type1" id="S25T3U1108">m</span>, <span class="mxinfo " id="T3:U857">1</span>)</span>, <span class="mxinfo " id="T3:U858">1</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">        <span class="mxinfo " id="T3:U859"><span class="mxinfo " id="T3:U860"><span class="var type1" id="S44T2U1114">zmm</span>(<span class="mxinfo " id="T3:U862"><span class="var type1" id="S37T3U1116">count</span> + <span class="mxinfo " id="T3:U864">1</span></span>)</span> = <span class="mxinfo " id="T3:U865"><span class="mxinfo " id="T3:U866"><span class="var type1" id="S20T4U1120">P</span>(<span class="mxinfo " id="T3:U868"><span class="var type1" id="S21T4U1122">D</span>(<span class="var type1" id="S25T3U1123">m</span>, <span class="mxinfo " id="T3:U871">1</span>)</span>, <span class="mxinfo " id="T3:U872">2</span>)</span> + <span class="mxinfo " id="T3:U873"><span class="mxinfo " id="T3:U874"><span class="var type1" id="S21T4U1128">D</span>(<span class="var type1" id="S25T3U1129">m</span>, <span class="mxinfo " id="T3:U877">2</span>)</span> * (<span class="mxinfo " id="T3:U878"><span class="mxinfo " id="T3:U879"><span class="var type1" id="S20T4U1134">P</span>(<span class="mxinfo " id="T3:U881"><span class="mxinfo " id="T3:U882"><span class="var type1" id="S21T4U1137">D</span>(<span class="var type1" id="S25T3U1138">m</span>, <span class="mxinfo " id="T3:U885">1</span>)</span>+<span class="mxinfo " id="T3:U886">1</span></span>, <span class="mxinfo " id="T3:U887">2</span>)</span> - <span class="mxinfo " id="T3:U888"><span class="var type1" id="S20T4U1143">P</span>(<span class="mxinfo " id="T3:U890"><span class="var type1" id="S21T4U1145">D</span>(<span class="var type1" id="S25T3U1146">m</span>, <span class="mxinfo " id="T3:U893">1</span>)</span>, <span class="mxinfo " id="T3:U894">2</span>)</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">        <span class="mxinfo " id="T3:U895"><span class="var type1" id="S37T3U1151">count</span> = <span class="mxinfo " id="T3:U897"><span class="var type1" id="S37T3U1153">count</span> + <span class="mxinfo " id="T3:U899">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line"><span class="comment">%% Linke und rechte Linie kombinieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo " id="T1:U900"><span class="var type1" id="S45T1U1157">H</span> = <span class="mxinfo " id="T1:U902">[<span class="var type1" id="S32T1U1160">Hl</span>; <span class="var type1" id="S38T1U1162">Hr</span>; <span class="var type1" id="S42T1U1164">Hm</span>]</span></span>; <span class="comment">%Messmatrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line"><span class="mxinfo " id="T2:U906"><span class="var type1" id="S46T2U1167">z</span> = <span class="mxinfo " id="T2:U908">[<span class="var type1" id="S34T2U1170">zl</span>; <span class="var type1" id="S39T2U1172">zr</span>; <span class="var type1" id="S43T2U1174">z_m</span>]</span></span>; <span class="comment">%Messwerte</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo " id="T2:U912"><span class="var type1" id="S47T2U1177">zm</span> = <span class="mxinfo " id="T2:U914">[<span class="var type1" id="S36T2U1180">zml</span>; <span class="var type1" id="S40T2U1182">zmr</span>; <span class="var type1" id="S44T2U1184">zmm</span>]</span></span>; <span class="comment">%erwartete Werte</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line"><span class="comment">%% KALMAN FILTER    </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"><span class="comment">%state transition (experimentell und vereinfacht)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo " id="T1:U918"><span class="var type1" id="S48T1U1187">A</span> = <span class="mxinfo " id="T1:U920">zeros(<span class="mxinfo " id="T3:U921">numel(<span class="var type1" id="S2T2U1192">r</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T3:U923"><span class="mxinfo " id="T3:U924"><span class="var type1" id="S48T1U1196">A</span>(<span class="mxinfo " id="T3:U926">1</span>,<span class="mxinfo " id="T3:U927">1</span>)</span> = <span class="mxinfo " id="T3:U928"><span class="mxinfo " id="T3:U929">1</span>-<span class="mxinfo " id="T3:U930"><span class="var type1" id="S5T3U1202">delta_y</span>/<span class="mxinfo " id="T3:U932"><span class="var type1" id="S2T2U1204">r</span>(<span class="mxinfo " id="T3:U934">1</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line"><span class="mxinfo " id="T3:U935"><span class="mxinfo " id="T3:U936"><span class="var type1" id="S48T1U1209">A</span>(<span class="mxinfo " id="T3:U938">2</span>,<span class="mxinfo " id="T3:U939">2</span>)</span> = <span class="mxinfo " id="T3:U940"><span class="mxinfo " id="T3:U941">1</span>-<span class="mxinfo " id="T3:U942"><span class="var type1" id="S6T3U1215">delta_phi</span>/<span class="mxinfo " id="T3:U944"><span class="var type1" id="S2T2U1217">r</span>(<span class="mxinfo " id="T3:U946">2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo " id="T3:U947"><span class="mxinfo " id="T3:U948"><span class="var type1" id="S48T1U1222">A</span>(<span class="mxinfo " id="T3:U950">2</span>,<span class="mxinfo " id="T3:U951">3</span>)</span> = <span class="mxinfo " id="T3:U952"><span class="var type1" id="S4T3U1226">delta_x</span>/<span class="mxinfo " id="T3:U954">sqrt(<span class="mxinfo " id="T3:U955"><span class="mxinfo " id="T3:U956">1</span>-<span class="mxinfo " id="T3:U957"><span class="mxinfo " id="T3:U958"><span class="mxinfo " id="T3:U959"><span class="var type1" id="S9T3U1234">delta</span>^2</span>*<span class="mxinfo " id="T3:U961"><span class="mxinfo " id="T3:U962"><span class="var type1" id="S2T2U1238">r</span>(<span class="mxinfo " id="T3:U964">3</span>)</span>^2</span></span>/<span class="mxinfo " id="T3:U965">4</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S49T3U1244">i</span>=<span class="mxinfo " id="T3:U967">3</span>:<span class="mxinfo " id="T3:U968"><span class="mxinfo " id="T3:U969">numel(<span class="var type1" id="S2T2U1250">r</span>)</span>-<span class="mxinfo " id="T3:U971">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">    <span class="mxinfo " id="T3:U972"><span class="mxinfo " id="T3:U973"><span class="var type1" id="S48T1U1255">A</span>(<span class="var type1" id="S49T3U1256">i</span>,<span class="var type1" id="S49T3U1257">i</span>)</span> = <span class="mxinfo " id="T3:U977"><span class="mxinfo " id="T3:U978">1</span>-<span class="mxinfo " id="T3:U979"><span class="var type1" id="S4T3U1261">delta_x</span>/<span class="var type1" id="S9T3U1262">delta</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">    <span class="mxinfo " id="T3:U982"><span class="mxinfo " id="T3:U983"><span class="var type1" id="S48T1U1266">A</span>(<span class="var type1" id="S49T3U1267">i</span>,<span class="mxinfo " id="T3:U986"><span class="var type1" id="S49T3U1269">i</span>+<span class="mxinfo " id="T3:U988">1</span></span>)</span> = <span class="mxinfo " id="T3:U989"><span class="var type1" id="S4T3U1272">delta_x</span>/<span class="var type1" id="S9T3U1273">delta</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line"><span class="mxinfo " id="T3:U992"><span class="mxinfo " id="T3:U993"><span class="var type1" id="S48T1U1277">A</span>(<span class="mxinfo " id="T3:U995">numel(<span class="var type1" id="S2T2U1280">r</span>)</span>,<span class="mxinfo " id="T3:U997">numel(<span class="var type1" id="S2T2U1283">r</span>)</span>)</span> = <span class="mxinfo " id="T3:U999">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line"><span class="mxinfo " id="T2:U1000"><span class="var type1" id="S2T2U1287">r</span> = <span class="mxinfo " id="T2:U1002"><span class="var type1" id="S48T1U1289">A</span>*<span class="var type1" id="S2T2U1290">r</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line"><span class="comment">% r(1) = r(1) - delta_y;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line"><span class="comment">% r(2) = r(2) - delta_phi;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line"><span class="mxinfo " id="T1:U1005"><span class="var type1" id="S50T1U1293">R</span> = <span class="mxinfo " id="T1:U1007"><span class="mxinfo " id="T1:U1008">eye(<span class="mxinfo " id="T3:U1009"><span class="mxinfo " id="T3:U1010">2</span>*(<span class="mxinfo " id="T3:U1011"><span class="mxinfo " id="T3:U1012"><span class="mxinfo " id="T3:U1013">numel(<span class="var type1" id="S10T2U1304">xl</span>)</span>+<span class="mxinfo " id="T3:U1015">numel(<span class="var type1" id="S12T2U1307">xr</span>)</span></span>+<span class="mxinfo " id="T3:U1017">numel(<span class="var type1" id="S14T2U1310">xm</span>)</span></span>)</span>)</span>.*<span class="var type1" id="S8T3U1311">R_fakt</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line"><span class="mxinfo " id="T1:U1020"><span class="var type1" id="S3T1U1314">Pk</span> = <span class="mxinfo " id="T1:U1022"><span class="mxinfo " id="T1:U1023"><span class="mxinfo " id="T1:U1024"><span class="var type1" id="S48T1U1318">A</span>*<span class="var type1" id="S3T1U1319">Pk</span></span>*<span class="mxinfo " id="T1:U1027"><span class="var type1" id="S48T1U1321">A</span>'</span></span> + <span class="var type1" id="S7T1U1322">Q</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line"><span class="mxinfo " id="T2:U1030"><span class="var type1" id="S52T2U1325">y_tilde</span> = <span class="mxinfo " id="T2:U1032"><span class="var type1" id="S46T2U1327">z</span> - <span class="var type1" id="S47T2U1328">zm</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line"><span class="mxinfo " id="T1:U1035"><span class="var type1" id="S53T1U1331">K</span> = <span class="mxinfo " id="T1:U1037"><span class="mxinfo " id="T1:U1038"><span class="var type1" id="S3T1U1334">Pk</span>*<span class="mxinfo " id="T1:U1040"><span class="var type1" id="S45T1U1336">H</span>'</span></span>/(<span class="mxinfo " id="T1:U1042"><span class="mxinfo " id="T1:U1043"><span class="mxinfo " id="T1:U1044"><span class="var type1" id="S45T1U1341">H</span>*<span class="var type1" id="S3T1U1342">Pk</span></span>*<span class="mxinfo " id="T1:U1047"><span class="var type1" id="S45T1U1344">H</span>'</span></span> + <span class="var type1" id="S50T1U1345">R</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo " id="T2:U1050"><span class="var type1" id="S2T2U1348">r</span> = <span class="mxinfo " id="T2:U1052"><span class="var type1" id="S2T2U1350">r</span> + <span class="mxinfo " id="T2:U1054"><span class="var type1" id="S53T1U1352">K</span>*<span class="var type1" id="S52T2U1353">y_tilde</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo " id="T1:U1057"><span class="var type1" id="S3T1U1356">Pk</span> = <span class="mxinfo " id="T1:U1059">(<span class="mxinfo " id="T1:U1060"><span class="mxinfo " id="T1:U1061">eye(<span class="mxinfo " id="T3:U1062">numel(<span class="var type1" id="S2T2U1364">r</span>)</span>)</span> - <span class="mxinfo " id="T1:U1064"><span class="var type1" id="S53T1U1366">K</span>*<span class="var type1" id="S45T1U1367">H</span></span></span>)*<span class="var type1" id="S3T1U1368">Pk</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line"><span class="comment">%% Zustandsbegrenzungen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line"><span class="comment">% Krümmung</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line"><span class="mxinfo " id="T3:U1068"><span class="var type1" id="S54T3U1371">kr</span> = <span class="mxinfo " id="T3:U1070">0.75</span></span>; <span class="comment">% bezogen auf Mittellinie, 0.72 entspricht einem minimalen Innenradius von 1m</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S49T3U1375">i</span>=<span class="mxinfo " id="T3:U1072">3</span>:<span class="mxinfo " id="T3:U1073">numel(<span class="var type1" id="S2T2U1380">r</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">    <span class="mxinfo " id="T3:U1075"><span class="mxinfo " id="T3:U1076"><span class="var type1" id="S2T2U1384">r</span>(<span class="var type1" id="S49T3U1385">i</span>)</span> = <span class="mxinfo " id="T3:U1079">max(<span class="mxinfo " id="T3:U1080">-<span class="var type1" id="S54T3U1389">kr</span></span>, <span class="mxinfo " id="T3:U1082"><span class="var type1" id="S2T2U1391">r</span>(<span class="var type1" id="S49T3U1392">i</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">    <span class="mxinfo " id="T3:U1085"><span class="mxinfo " id="T3:U1086"><span class="var type1" id="S2T2U1396">r</span>(<span class="var type1" id="S49T3U1397">i</span>)</span> = <span class="mxinfo " id="T3:U1089">min(<span class="mxinfo " id="T3:U1090"><span class="var type1" id="S54T3U1400">kr</span></span>, <span class="mxinfo " id="T3:U1092"><span class="var type1" id="S2T2U1402">r</span>(<span class="var type1" id="S49T3U1403">i</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line"><span class="comment">% y-Wert des ersten Punktes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line"><span class="mxinfo " id="T3:U1095"><span class="var type1" id="S57T3U1406">y_max</span> = <span class="mxinfo " id="T3:U1097">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line"><span class="mxinfo " id="T3:U1098"><span class="mxinfo " id="T3:U1099"><span class="var type1" id="S2T2U1411">r</span>(<span class="mxinfo " id="T3:U1101">1</span>)</span> =  <span class="mxinfo " id="T3:U1102">max(<span class="mxinfo " id="T3:U1103">-<span class="var type1" id="S57T3U1416">y_max</span></span>, <span class="mxinfo " id="T3:U1105">min(<span class="mxinfo " id="T3:U1106"><span class="var type1" id="S57T3U1419">y_max</span></span>, <span class="mxinfo " id="T3:U1108"><span class="var type1" id="S2T2U1421">r</span>(<span class="mxinfo " id="T3:U1110">1</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line"><span class="comment">% Startwinkel </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line"><span class="mxinfo " id="T3:U1111"><span class="var type1" id="S58T3U1425">phi_max</span> = <span class="mxinfo " id="T3:U1113">0.78</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line"><span class="mxinfo " id="T3:U1114"><span class="mxinfo " id="T3:U1115"><span class="var type1" id="S2T2U1430">r</span>(<span class="mxinfo " id="T3:U1117">2</span>)</span> =  <span class="mxinfo " id="T3:U1118">max(<span class="mxinfo " id="T3:U1119">-<span class="var type1" id="S58T3U1435">phi_max</span></span>, <span class="mxinfo " id="T3:U1121">min(<span class="mxinfo " id="T3:U1122"><span class="var type1" id="S58T3U1438">phi_max</span></span>, <span class="mxinfo " id="T3:U1124"><span class="var type1" id="S2T2U1440">r</span>(<span class="mxinfo " id="T3:U1126">2</span>)</span>)</span>)</span></span>; <span class="comment">% 45°</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line"></span></span>
</pre>
